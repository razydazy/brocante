{% comment %}theme-check-disable MissingTemplate{% endcomment %}
{%- liquid
  assign ratio = section.settings.crop | plus: 0.0
  assign section_color = section.settings.color_scheme
  assign selected_blog = blogs[section.settings.blog]
-%}
<section class="bg-scheme-background text-scheme-text blog-posts section-y-padding" data-color-scheme="{{ section_color }}">
  <div class="wrapper">
    {%- if section.settings.title != blank -%}
      <h2 class="font-heading section-title-align {{ settings.section_heading_font_size }}">
        {%- if section.settings.title == blank -%}
          {{ selected_blog.title }}
        {%- else %}
          {{ section.settings.title  }}
        {%- endif %}
      </h2>
    {%- endif -%}

    <ul class="grid lg:grid-cols-3 gap-10 mt-10">
      {% for article in selected_blog.articles limit: section.settings.post_limit %}
        <li class="relative {{ section.settings.text_align }} group" data-fade-in>
          {% if article.image %}
            {% render 'image-crop' with
              image: article.image,
              ratio: ratio
            %}
          {% endif %}

          <h3 class="font-heading text-xl leading-snug mt-4">
            <a href="{{ article.url }}">
              {{ article.title }}
              <span class="absolute top-0 left-0 w-full h-full z-10 block"></span>
            </a>
          </h3>
          {%- if section.settings.blog_show_date -%}
          <time class="font-body text-sm mt-4 block" datetime="{{ article.published_at | date: '%Y-%m-%d' }}">{{ article.published_at | date: format: 'month_day_year' }}</time>
          {%- endif -%}
          {% if section.settings.blog_show_author %}
          <p class="font-body text-sm mt-0">{{ 'blogs.article.by_author' | t: author: article.author }}</p>
          {% endif %}
          {% comment %}
            Add a surrounding div with class 'rte' to anything that will come from the rich text editor.
            Since this is just a listing page, you can either use the excerpt or truncate the full article.
          {% endcomment %}
          {% if section.settings.show_post_excerpt %}
            <div class="mt-4 text-base">
              {% if article.excerpt.size > 0 %}
                {{ article.excerpt }}
              {% else %}
                <p>{{ article.content | strip_html | truncatewords: 40 }}</p>
              {% endif %}
            </div>
          {% endif %}
          {% if section.settings.show_post_link %}
            <p class="read-more text-sm mt-4 text-scheme-text hover:text-scheme-accent inline-flex items-center" aria-hidden="true">
              {{ 'blogs.article.read_more' | t }}
              <span class="inline-block h-4 w-4 ml-2">{% render 'icon-right_arrow' %}</span>
            </p>
          {% endif %}
        </li>
      {% else %}
        {% for i in (1..section.settings.post_limit) %}
          <li>
            <div class="bg-placeholder-bg fill-current relative">
              {{ 'image' | placeholder_svg_tag }}
            </div>

            <h3 class="font-heading text-lg leading-snug mt-4">
              {{ 'homepage.onboarding.blog_title' | t }}
            </h3>
          </li>
        {% endfor %}
      {% endfor %}
    </ul>
  </div>

  {% if section.settings.show_blog_link %}
    <div class="mt-10 text-center">
      <a href="{{ selected_blog.url }}" class="btn btn-outline-{{ section_color }}-{{ settings.outline_button_color }}" aria-label="{{ 'blogs.article.view_all_blogs' | t }}">
        <span class="btn-text">{{ 'blogs.article.read_more' | t }}</span>
        {% if settings.buttons_show_arrow %}<span class="btn-icon">{% render 'icon-right_arrow' %}</span>{% endif %}
      </a>
    </div>
  {% endif %}

</section>

{% schema %}
  {
    "name": "Blog posts",
    "disabled_on": {
      "groups": ["header", "footer", "aside"]
    },
    "settings": [
      {
        "type": "text",
        "id": "title",
        "label": "Heading",
        "default": "Blog posts"
      },
      {
        "id": "blog",
        "type": "blog",
        "label": "Blog"
      },
      {
        "type": "range",
        "id": "post_limit",
        "label": "Posts",
        "min": 3,
        "max": 12,
        "step": 3,
        "default": 3
      },
      {
        "type": "select",
        "id": "crop",
        "label": "Crop images",
        "options": [
          {
            "value": "0",
            "label": "No crop"
          },
          {
            "value": "1.3",
            "label": "Landscape"
          },
          {
            "value": "1",
            "label": "Square"
          },
          {
            "value": "0.8",
            "label": "Portrait"
          }
        ],
        "default": "1"
      },
      {
        "type": "checkbox",
        "id": "blog_show_author",
        "label": "Show author",
        "default": false
      },
      {
        "type": "checkbox",
        "id": "blog_show_date",
        "label": "Show date",
        "default": true
      },
      {
        "type": "checkbox",
        "id": "show_post_excerpt",
        "label": "Show post excerpt",
        "default": true
      },
      {
        "type": "checkbox",
        "id": "show_post_link",
        "label": "Show post link",
        "default": false
      },
      {
        "type": "checkbox",
        "id": "show_blog_link",
        "label": "Show link to blog",
        "default": true
      },
      {
        "type": "select",
        "id": "text_align",
        "label": "Text align",
        "default": "text-left",
        "options": [
          {
            "value": "text-left",
            "label": "Left"
          },
          {
            "value": "text-center",
            "label": "Center"
          }
        ]
      },
      {
        "type":      "header",
        "content":   "Color"
      },
      {
        "type": "select",
        "id": "color_scheme",
        "label": "Color scheme",
        "options": [
            { "value": "primary", "label": "Primary"},
            { "value": "secondary", "label": "Secondary"},
            { "value": "tertiary", "label": "Tertiary"}
        ],
        "default":   "primary"
      }
    ],
    "presets": [
      {
        "name": "Blog posts",
        "settings": {
          "blog": "News",
          "post_limit": 3
        }
      }
    ]
  }
{% endschema %}

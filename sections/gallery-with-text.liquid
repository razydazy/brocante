{%- liquid
  assign section_color = section.settings.color_scheme
  assign blocks_per_row_desktop = section.settings.blocks_per_row_desktop
  assign heading_class = 'text-xl'
  assign description_class = 'rte'
  if blocks_per_row_desktop == "2"
    assign heading_class = 'text-xl lg:text-2xl'
    assign description_class = 'text-rte'
  endif
-%}

<section class="bg-scheme-background text-scheme-text artists section-y-padding" data-color-scheme="{{ section_color }}">

  {% unless section.settings.heading == blank %}
  <div class="wrapper mb-10">
    <h2 class="font-heading section-title-align {{ settings.section_heading_font_size }}">
      {{ section.settings.heading | strip | escape }}
    </h2>
  </div>
  {% endunless %}

  <div class="grid lg:grid-cols-{{ blocks_per_row_desktop }} gap-5 lg:gap-10 wrapper">
    {% for block in section.blocks %}
      {% liquid
        assign image = ''
        case block.type
          when 'collection'
            assign collection = block.settings.collection
            assign image = collection.featured_image
            assign title = collection.title
            assign description = collection.description
            assign link = collection.url
            if collection == blank
              assign title = 'sections.onboarding.collection_title' | t
            endif
          when 'product'
            assign product = block.settings.product
            assign image = product.featured_image
            assign title = product.title
            assign description = product.description
            assign link = product.url
            if product == blank
              assign title = 'sections.onboarding.product_title' | t
            endif
          when 'article'
            assign article = block.settings.article
            assign image = article.image
            assign title = article.title
            assign description = article.excerpt_or_content
            assign link = article.url
            if article == blank
              assign title = 'sections.onboarding.blog_title' | t
            endif
        endcase

        assign link_text = block.settings.link_text
        if block.settings.image != blank
          assign image = block.settings.image
        endif
        if block.settings.title != blank
          assign title = block.settings.title
        endif
        if block.settings.description != blank
          assign description = block.settings.description
        endif
        if block.settings.link != blank
          assign link = block.settings.link
        endif

        assign crop = false
        assign crop = true
        case section.settings.crop
          when 'landscape'
            assign ratio = 1.3
          when 'square'
            assign ratio = 1
          when 'portrait'
            assign ratio = 0.8
          else
            assign ratio = 0
        endcase
      %}
      <div class="relative group {{ section.settings.text_align }}" {{ block.shopify_attributes }} data-fade-in>
        {% render 'gallery-with-text-block',
           image: image,
           title: title,
           heading_class: heading_class,
           description_class: description_class,
           description: description,
           link: link,
           link_text: link_text,
           crop: crop,
           ratio: ratio
        %}
      </div>
    {% endfor %}
  </div>

</section>

{% schema %}
{
  "name": "Gallery with text",
  "disabled_on": {
    "groups": ["header", "footer", "aside"]
  },
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading"
    },
    {
      "type": "select",
      "id": "blocks_per_row_desktop",
      "label": "Blocks per row - desktop",
      "default": "3",
      "options": [
        {
          "value": "2",
          "label": "2"
        },
        {
          "value": "3",
          "label": "3"
        },
        {
          "value": "4",
          "label": "4"
        }
      ]
    },
    {
      "type": "select",
      "id": "crop",
      "label": "Crop",
      "options": [
        {
          "value": "none",
          "label": "No crop"
        },
        {
          "value": "landscape",
          "label": "Landscape"
        },
        {
          "value": "square",
          "label": "Square"
        },
        {
          "value": "portrait",
          "label": "Portrait"
        }
      ],
      "default": "landscape"
    },
    {
      "type": "select",
      "id": "text_align",
      "label": "Text align",
      "default": "text-left",
      "options": [
        {
          "value": "text-left",
          "label": "Left"
        },
        {
          "value": "text-center",
          "label": "Center"
        }
      ]
    },
    {
      "type":      "header",
      "content":   "Color"
    },
    {
      "type": "select",
      "id": "color_scheme",
      "label": "Color scheme",
      "options": [
          { "value": "primary", "label": "Primary"},
          { "value": "secondary", "label": "Secondary"},
          { "value": "tertiary", "label": "Tertiary"}
      ],
      "default":   "primary"
    }
  ],
  "blocks": [
    {
      "type": "image",
      "name": "Image",
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": "Image"
        },
        {
          "type": "text",
          "id": "title",
          "label": "Title",
          "default": "Title"
        },
        {
          "type": "richtext",
          "id": "description",
          "label": "Description",
          "default": "<p>Short description</p>"
        },
        {
          "type": "url",
          "id": "link",
          "label": "Link"
        },
        {
          "type": "text",
          "id": "link_text",
          "label": "Button text"
        }
      ]
    },
    {
      "type": "collection",
      "name": "Collection",
      "settings": [
        {
          "type": "collection",
          "id": "collection",
          "label": "Collection"
        },
        {
          "type": "header",
          "content": "Overrides",
          "info": "Leave blank to use collection defaults"
        },
        {
          "type": "image_picker",
          "id": "image",
          "label": "Image"
        },
        {
          "type": "richtext",
          "id": "description",
          "label": "Description"
        }
      ]
    },
    {
      "type": "product",
      "name": "Product",
      "settings": [
        {
          "type": "product",
          "id": "product",
          "label": "Product"
        },
        {
          "type": "header",
          "content": "Overrides",
          "info": "Leave blank to use product defaults"
        },
        {
          "type": "image_picker",
          "id": "image",
          "label": "Image"
        },
        {
          "type": "richtext",
          "id": "description",
          "label": "Description"
        }
      ]
    },
    {
      "type": "article",
      "name": "Article",
      "settings": [
        {
          "type": "article",
          "id": "article",
          "label": "Article"
        },
        {
          "type": "header",
          "content": "Overrides",
          "info": "Leave blank to use article defaults"
        },
        {
          "type": "image_picker",
          "id": "image",
          "label": "Image"
        },
        {
          "type": "richtext",
          "id": "description",
          "label": "Description"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Gallery with text",
      "blocks": [
        {
          "type": "image"
        },
        {
          "type": "image"
        },
        {
          "type": "image"
        }
      ]
    }
  ]
}
{% endschema %}

<!-- sections/gallery.liquid -->
{%- liquid
  assign section_color = section.settings.color_scheme
  if section.settings.full_width and section.settings.heading == blank
    assign full_width = true
    assign section_class = 'section-with-no-padding'
  elsif section.settings.full_width and section.settings.heading != blank
    assign full_width = true
    assign section_class = 'section-t-padding'
  else
    assign section_class = 'section-y-padding'
  endif
  assign text_size = section.settings.text_size
  assign images_per_row_desktop = section.settings.images_per_row_desktop
-%}

{%-  if section.settings.full_width and section.settings.heading == blank and template contains "gallery" -%}
  <style>
    #main-breadcrumbs {
      display: none;
    }
  </style>
{%- endif -%}

<section
  class="gallery {{ section_class }} bg-scheme-background text-scheme-text"
  data-section-type="gallery"
  data-section-id="{{ section.id }}"
  data-color-scheme="{{ section_color }}">

  {% unless section.settings.heading == blank %}
  <div class="wrapper mb-10">
    <h2 class="font-heading section-title-align {{ settings.section_heading_font_size }}">
      {{ section.settings.heading | strip | escape }}
    </h2>
  </div>
  {% endunless %}

  <div class="grid  lg:grid-cols-{{ images_per_row_desktop }} {% unless full_width %} {% unless section.settings.heading == blank %}mt-10{% endunless %} gap-5 lg:gap-10 wrapper{% endunless %}">
    {% for block in section.blocks %}

    {%- liquid
      case block.type
        when 'image'
          assign url = block.settings.url
          assign image = block.settings.image
          assign caption = block.settings.caption
        when 'product'
          assign product = block.settings.product
          assign url = product.url
          assign image = product.featured_image
          assign caption = product.title
        when 'collection'
          assign collection = block.settings.collection
          assign url = collection.url
          assign image = collection.featured_image
          assign caption = collection.title
        when 'article'
          assign article = block.settings.article
          assign url = article.url
          assign image = article.image
          assign caption = article.title
      endcase
    -%}
    {% comment %}theme-check-disable UndefinedObject{% endcomment %}
    <div class="gallery-item relative overflow-hidden" {{ shopify.block_attributes }}  data-fade-in>
    {% comment %}theme-check-enable UndefinedObject{% endcomment %}
      {% if url != blank %}
      <a href="{{ url }}" class="block group">
      {% endif %}

        <div class="gallery-item__image">
          {%- if image != blank -%}
            {%- liquid
              case section.settings.crop
                when 'landscape'
                  assign ratio = '1.3'
                when 'square'
                  assign ratio = '1'
                when 'portrait'
                  assign ratio = '0.8'
                else
                  assign ratio = '0'
              endcase
              assign ratio = ratio | plus: 0 | times: 1.0
              render 'image-crop' with image: image, ratio: ratio
            -%}
          {%- else -%}
          <div class="bg-placeholder-bg">
            {%- if section.settings.crop == 'none' -%}
              <div class="gallery-placeholder">
                {%- if full_width -%}
                  {% assign placeholder_svg_tag = 'placeholder-svg placeholder-svg--no-border' %}
                {%- else -%}
                  {% assign placeholder_svg_tag = 'placeholder-svg' %}
                {%- endif -%}
                {{ 'image' | placeholder_svg_tag: placeholder_svg_tag }}
              </div>
            {%- else -%}
              {%- case section.settings.crop -%}
                {% when 'landscape' %}
                  {%- assign ratio = '1.3' -%}
                {% when 'square' %}
                  {%- assign ratio = '1' -%}
                {% when 'portrait' %}
                  {%- assign ratio = '0.8' -%}
              {%- endcase -%}
              <div class="gallery-placeholder--cropped relative"
                style="padding-top:{{ 1 | divided_by: ratio | times: 100 }}%;" >
                {%- if full_width -%}
                  {% assign placeholder_svg_tag = 'placeholder-svg fill-current gallery-placeholder--cropped__svg placeholder-svg--no-border' %}
                {%- else -%}
                  {% assign placeholder_svg_tag = 'placeholder-svg fill-current  gallery-placeholder--cropped__svg' %}
                {%- endif -%}
                <span class="absolute top-0 left-0 right-0 bottom-0 text-scheme-text">{{ 'image' | placeholder_svg_tag: placeholder_svg_tag }}</span>
              </div>
            {%- endif -%}
          </div>
          {%- endif -%}
        </div>

        {%- if caption != blank -%}
        <div class="gallery-item__content absolute top-0 left-0 right-0 bottom-0 flex items-center justify-center font-heading {{ text_size }} text-center" data-color-scheme="{{ section.settings.text_color }}">
          <span class="type-text-overlay break-words w-full text-scheme-text">{{ caption }}</span>
        </div>
        {%- endif -%}

      {%- if url != blank -%}
      </a>
      {%- endif -%}
    </div>
    {% endfor %}
  </div>

</section>
{% schema %}
{
  "name": "Gallery",
  "class": "section-gallery",
  "max_blocks": 8,
  "disabled_on": {
    "groups": ["header", "footer", "aside"]
  },
  "settings": [
    {
      "id": "heading",
      "type": "text",
      "label": "Heading",
      "default": "Gallery"
    },
    {
      "type":      "select",
      "id":        "text_size",
      "label":     "Text size",
      "options": [
        {
          "value": "text-lg lg:text-2xl",
          "label": "Small"
        },
        {
          "value": "text-2xl lg:text-3xl",
          "label": "Medium"
        },
        {
          "value": "text-3xl lg:text-5xl",
          "label": "Large"
        }
      ],
      "default":   "text-3xl lg:text-5xl"
    },
    {
      "type": "checkbox",
      "id": "full_width",
      "label": "Full width",
      "default": true
    },
    {
      "type": "select",
      "id": "images_per_row_desktop",
      "label": "Images per row - desktop",
      "default": "3",
      "options": [
        {
          "value": "2",
          "label": "2"
        },
        {
          "value": "3",
          "label": "3"
        },
        {
          "value": "4",
          "label": "4"
        }
      ]
    },
    {
      "type": "select",
      "id": "crop",
      "label": "Crop images",
      "options": [
        {
          "value": "none",
          "label": "No crop"
        },
        {
          "value": "landscape",
          "label": "Landscape"
        },
        {
          "value": "square",
          "label": "Square"
        },
        {
          "value": "portrait",
          "label": "Portrait"
        }
      ],
      "default": "square"
    },
    {
      "type":      "header",
      "content":   "Color"
    },
    {
      "type": "select",
      "id": "color_scheme",
      "label": "Color scheme",
      "options": [
          { "value": "primary", "label": "Primary"},
          { "value": "secondary", "label": "Secondary"},
          { "value": "tertiary", "label": "Tertiary"}
      ],
      "default":   "primary"
    },
    {
      "type": "select",
      "id": "text_color",
      "label": "Text color",
      "options": [
        { "value": "primary", "label": "Primary"},
        { "value": "secondary", "label": "Secondary"},
        { "value": "tertiary", "label": "Tertiary"},
        { "value": "white", "label": "White"},
        { "value": "black", "label": "Black"}
      ],
      "default":   "white"
    }
  ],
  "blocks": [
    {
      "type": "image",
      "name": "Image",
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": "Image"
        },
        {
          "type": "text",
          "id": "caption",
          "label": "Caption (optional)"
        },
        {
          "type": "url",
          "id": "url",
          "label": "Link (optional)"
        }
      ]
    },
    {
      "type": "product",
      "name": "Product",
      "settings": [
        {
          "type": "product",
          "id": "product",
          "label": "Product"
        }
      ]
    },
    {
      "type": "collection",
      "name": "Collection",
      "settings": [
        {
          "type": "collection",
          "id": "collection",
          "label": "Collection"
        }
      ]
    },
    {
      "type": "article",
      "name": "Article",
      "settings": [
        {
          "type": "article",
          "id": "article",
          "label": "Article"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Gallery",
      "blocks": [
        {
          "type": "image"
        },
        {
          "type": "image"
        },
        {
          "type": "image"
        },
        {
          "type": "image"
        },
        {
          "type": "image"
        },
        {
          "type": "image"
        }
      ]
    }
  ]
}
{% endschema %}

{% comment %}theme-check-disable MissingTemplate{% endcomment %}
{% paginate search.results by 10 %}
{%- liquid
  assign section_color = 'primary'

  assign enable_filtering = section.settings.enable_filtering
  assign enable_sorting = section.settings.enable_sorting

  if search.filters != empty
    if enable_filtering == true
      assign show_filters = true
    endif
  endif

  assign main_class = 'lg:col-span-12'

  if show_filters
    assign sidebar_class = 'lg:col-span-2'
    assign main_class = 'lg:col-start-4 lg:col-span-9'
  endif

  assign sort_by = search.sort_by | default: search.default_sort_by
  assign terms = search.terms | escape
  assign search_url = '?q=' | append: terms | append: '&options%5Bprefix%5D=last&sort_by=' | append: sort_by
-%}

<section {% if show_filters or enable_sorting %}data-section-type="filterable" data-section-id="{{ section.id }}" x-data="ThemeSection_filterable()" x-init="mounted()"{% endif %} data-color-scheme="{{ section_color }}">
  {% if enable_filtering == false and enable_sorting == true %}
  <form id="Facet-Filters-Form" @submit.prevent="filterFormSubmit" class="hidden">
    <input type="hidden" name="q" value="{{ search.terms | escape }}">
    <input name="options[prefix]" type="hidden" value="last">
  </form>
  {% endif %}

  <div class="section-y-padding wrapper">
    <div class="{% if settings.center_page_titles %}max-w-xl mx-auto text-center{% endif %}">
      <h1 class="font-heading {{ settings.section_heading_font_size }}">
        {% if search.performed %}
          <span class="visually-hidden">{{ 'general.search.title_with_results' | t }}:</span>
            {{ 'general.search.title_with_results' | t }}
        {% else %}
          {{ 'general.search.title' | t }}
        {% endif %}
      </h1>

      <form class="relative my-8 -mx-1 border-text-width border-scheme-border" action="/search" method="get" role="search">
        <label for="Search" class="visually-hidden">
          {{ 'general.search.placeholder' | t }}
        </label>
        <input type="search"
              name="q"
              id="Search"
              class="pl-12 py-4 placeholder-current font-secondary w-full  pb-4"
              value="{{ search.terms | escape }}"
              placeholder="{{ 'general.search.placeholder' | t }}">
        <button class="absolute left-2 top-1/2 transform -translate-y-1/2 p-1" type="submit" class="button">
          <span class="inline-block w-7 h-7">{% render 'icon-search' %}</span>
          <span class="visually-hidden">{{ 'general.search.submit' | t }}</span>
        </button>
      </form>
    </div>

    <div id="facets-filterable">

      {%- if search.results_count > 0 -%}
      <h2 class="font-secondary text-base  m-0 product-count__text mb-4 lg:hidden">
        {{ 'general.search.results_with_count' | t: terms: search.terms, count: search.results_count }}
      </h2>
      {%- endif -%}

      {%- if show_filters or enable_sorting -%}
        <div class="flex justify-between items-center mt-4 lg:mt-8 lg:ml-auto {% unless enable_sorting %}lg:hidden{% endunless %}">
          {%- if search.results_count > 0 -%}
            <h2 class="font-secondary text-base  m-0 product-count__text mb-4 hidden lg:block">
              {{ 'general.search.results_with_count' | t: terms: search.terms, count: search.results_count }}
            </h2>
            {%- endif -%}
          {% if show_filters %}
            <div class="lg:hidden">
              <button data-filter-toggle
                  class="appearance-none border-0 border-b-text-width border-scheme-border border-b-text-width py-3 font-secondary text-sm whitespace-nowrap"
                  type="button"
                  x-bind:aria-expanded="$store.drawer.filterDrawerOpen"
                  @click="$store.drawer.filterDrawerOpen = !$store.drawer.filterDrawerOpen">
                <span class="inline-block align-middle h-4 w-4 mr-2">{% render 'icon-filters' %}</span>
                <span class="inline-block align-middle">{{ 'facets.filters.title_tags' | t }}</span>
              </button>
            </div>
          {% endif %}
          {% if enable_sorting and search.performed and search.results_count > 0 %}
            <div class="flex items-center ml-4">
              <label class="font-secondary text-sm mr-4 border-b border-transparent sr-only lg:not-sr-only lg:mr-4" for="Search-Sort">{{ 'facets.sorting.title' | t }}</label>
              <select
                form="Facet-Filters-Form"
                id="Search-Sort"
                name="sort_by"
                @input.debounce="filterFormSubmit"
                class="inline-block font-secondary text-sm pr-6 h-full">
                {%- for option in search.sort_options -%}
                  <option
                    value="{{ option.value | escape }}"
                    {% if option.value == sort_by %}selected="selected"{% endif %}>
                      {{ option.name | escape }}
                  </option>
                {% endfor %}
              </select>
            </div>
          {% endif %}
        </div>
      {%- endif -%}

      <div class="lg:grid lg:grid-cols-12 mt-8">

        {% if show_filters or enable_sorting %}
          <aside class="hidden lg:block {{ sidebar_class }}">
            <div class="hidden" id="facets-results-count">
              {%- if search.results_count -%}
                {{ 'general.search.results_with_count' | t: terms: search.results.terms, count: search.results.results_count }}
              {%- endif -%}
            </div>
            {% if show_filters %}
              {% render 'filters-desktop',
                 results: search,
                 section_color: section_color,
                 enable_color_swatch_filters: section.settings.enable_color_swatch_filters,
                 expand_filters: section.settings.expand_filters,
                 capitalize_filters: section.settings.capitalize_filters,
                 show_filter_count: section.settings.show_filter_count
              %}
            {% endif %}
          </aside>
        {% endif %}
        <div class="{{ main_class }}" id="facets-results">

          {% if search.performed %}
            {%- liquid
              assign products = search.results | where: "object_type", "product"
              assign articles = search.results | where: "object_type", "article"
              assign pages = search.results | where: "object_type", "page"
            -%}
            {% if search.results_count == 0 %}
              <p class="mt-4 lg:mt-8">
                {{ 'general.search.no_results' | t: terms: search.terms }}
                {% if search.filters != empty and section.settings.enable_filtering %}
                  {{ 'facets.filters.use_fewer_filters_html' | t: link: search_url, class: 'underline' }}.
                {% endif %}
              </p>
           {% else %}
            <div class="grid gap-5 lg:grid-cols-12 lg:gap-10">
              <div class="{%- if pages.size > 0 or articles.size > 0 -%}lg:col-span-9{% else %}col-span-12{% endif %}">
                <h2 id="predictive-search-products" class="-mt-2 font-secondary border-b-theme-width border-scheme-border py-2">
                  {{ 'general.search.products' | t }}
                </h2>
                <ul class="mt-4 lg:mt-8 grid grid-cols-3 gap-5 lg:gap-10 lg:grid-cols-5">
                {% for product in products %}
                  <li  class="py-2">
                    <a href="{{ product.url }}">
                      {%- if product.featured_media != blank -%}
                        {%- render 'responsive-image' with
                            image: product.featured_media.preview_image
                        -%}
                      {%- endif -%}
                      <div class="mt-2 {{ settings.product_grid_font }} {% if settings.product_grid_align == 'center' %}text-center{% endif %}">
                        <h3 class="text-sm">
                          {% if settings.products_split_title and product.title contains '-' %}
                            {%- assign title = product.title | split: '-' -%}
                            <p class="product-grid-title">{{ title | last | strip }}</p>
                            <p class="mt-1">{{ title | first | strip }}</p>
                          {% else %}
                            <p class="product-grid-title">{{ product.title }}</p>
                          {% endif %}
                        </h3>
                      </div>
                    </a>
                  </li>
                {% endfor %}
                </ul>
              </div>
              {%- if pages.size > 0 or articles.size > 0 -%}
              <div class="lg:col-span-3">
                <div class="-mt-8">
                  {%- assign articles = search.results | where: "object_type", "article" %}
                  {%- if articles.size > 0 -%}
                    <h2 class="font-secondary border-b-theme-width border-scheme-border pb-2 mt-8">
                      {{ 'general.search.articles' | t }}
                    </h2>
                    <ul class="mt-4  grid  gap:5 lg:gap-10">
                      {%- for article in articles -%}
                        <li class="py-2" >
                          <a href="{{ article.url }}" class="flex items-center">
                            {%- if article.image != blank -%}
                            <div class="w-16 mr-4">
                              {% render 'image-crop' with
                                image: article.image,
                                ratio: 1
                              %}
                            </div>
                            {%- endif -%}
                            <div class="text-left">
                              <h3 class="text-base">
                                <p class="product-grid-title">{{ article.title }}</p>
                              </h3>
                            </div>
                          </a>
                        </li>
                        {%- endfor -%}
                    </ul>
                  {%- endif -%}
                  {%- if pages.size > 0 -%}
                    <h2 class="font-secondary border-b-theme-width border-scheme-border pb-2 mt-8">
                      {{ 'general.search.pages' | t }}
                    </h2>
                    <ul class="mt-4  grid gap:5 lg:gap-10">
                      {%- for page in pages -%}
                        <li class="py-2">
                          <a href="{{ page.url }}">
                            <div class="mt-2 text-left">
                              <h3 class="text-base">
                                <p class="product-grid-title">{{ page.title }}</p>
                              </h3>
                            </div>
                          </a>
                        </li>
                        {%- endfor -%}
                    </ul>
                  {%- endif -%}
                </div>
              </div>
              {%- endif -%}
            </div>
            {% endif %}

            {% if paginate.pages > 1 %}
              {% render 'pagination', paginate: paginate %}
            {% endif %}

          {% endif %}
        </div>
      </div>
    </div>
    {% if show_filters or enable_sorting %}
      <div class="z-100 menu-drawer fixed top-0 right-0 bottom-0 w-80 px-4 py-8 bg-scheme-background transform overflow-y-auto"
           x-show="$store.drawer.filterDrawerOpen"
           x-transition:enter="transition ease duration-300"
           x-transition:enter-start="opacity-0 translate-x-full"
           x-transition:enter-end="opacity-100"
           x-transition:leave="transition ease duration-300"
           x-transition:leave-end="opacity-100 translate-x-full"
           @click.away.prevent="$store.drawer.filterDrawerOpen = false"
           role="dialog"
           aria-modal="true"
           data-filter-drawer
           aria-labelledby="FilterTitle"
           x-cloak>
        <div class="flex justify-between pb-4 items-center font-heading text-2xl border-b-theme-width border-scheme-border">
          <h1 id="FilterTitle">{{ 'facets.filters.title_tags' | t }}</h1>
          <div class="">
            <button @click.prevent="$store.drawer.filterDrawerOpen = false" class="w-6 h-6 ml-6">
              <span class="inline-block w-6 h-6 align-middle">{% render 'icon-close' %}</span>
              <span class="visually-hidden"> {{ 'layout.drawers.close_menu' | t }}</span>
            </button>
          </div>
        </div>
        {% render 'filters-mobile',
           results: search,
           section_color: section_color,
           enable_color_swatch_filters: section.settings.enable_color_swatch_filters,
           expand_filters: section.settings.expand_filters,
           capitalize_filters: section.settings.capitalize_filters,
           show_filter_count: section.settings.show_filter_count
        %}
      </div>
    {% endif %}
  </div>
</section>
{% endpaginate %}
{% schema %}
{
  "name": "Search",
  "settings": [
    {
      "type":      "header",
      "content":   "Filtering and Sorting"
    },
    {
      "type": "checkbox",
      "id": "enable_filtering",
      "label": "Enable filtering",
      "info": "[Customize filters](/admin/menus)"
    },
    {
      "type": "checkbox",
      "id": "expand_filters",
      "label": "Expand filters by default",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_filter_count",
      "label": "Show filter counts",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "enable_color_swatch_filters",
      "label": "Enable color swatch filters",
      "info": "[Learn how to set up swatches](https://help.switchthemes.co/label/settings/products.html#color-swatches)"
    },
    {
      "type": "checkbox",
      "id": "enable_sorting",
      "label": "Enable sorting"
    }
  ]
}
{% endschema %}

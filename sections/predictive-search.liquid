{% comment %}theme-check-disable MissingTemplate{% endcomment %}
{%- if predictive_search.performed -%}
  {%- liquid
    assign columns = false
    assign results = false
    if predictive_search.resources.products.size > 0
      assign results = true
    endif
    if predictive_search.resources.collections.size > 0 or predictive_search.resources.articles.size > 0 or predictive_search.resources.pages.size > 0
      assign results = true
      assign columns = true
    endif
  -%}

  <div id="predictive-search-results" class="pb-safe-bottom" data-color-scheme="primary">

    {%- if predictive_search.resources.products.size > 0 -%}
    <template x-if="loading">
      <div class="absolute top-0 left-0 right-0 bottom-0 flex items-center justify-center">
        <div class="w-4 h-4 opacity-40">
          <div class="loading"></div>
        </div>
      </div>
    </template>
    {%- endif -%}

      <div  :class="{'opacity-100': !loading }" class="transition-opacity opacity-0 grid gap-5 lg:grid-cols-12 lg:gap-10">
        {%- if predictive_search.resources.queries.size > 0 -%}
          <div class="col-span-full">
            <h2 class="font-secondary border-b-theme-width border-scheme-border pb-2">
              {{ 'general.search.suggestions' | t }}
            </h2>

            <ul id="predictive-search-results-queries" class="mt-2" role="listbox" aria-label="{{ 'general.search.suggestions' | t }}">
              {%- for query in predictive_search.resources.queries -%}
                <li id="predictive-search-option-{{ forloop.index }}" class="predictive-search__option py-2" role="option" aria-selected="false">
                  <a href="{{ query.url }}">
                    <p class="predictive-search__query-suggestion" aria-label="{{ query.text }}">{{ query.styled_text }}</p>
                  </a>
                </li>
              {%- endfor -%}
            </ul>
          </div>
        {%- endif -%}

        {%- if predictive_search.resources.products.size > 0 -%}
        <div class="{% if columns %}lg:col-span-9{% else %}lg:col-span-full{% endif %}">
          {%- if columns -%}
            <h2 id="predictive-search-products" class="font-secondary border-b-theme-width border-scheme-border pb-2">
              {{ 'general.search.products' | t }}
            </h2>
          {%- endif -%}
          <ul id="predictive-search-results-list" class="mt-2 grid grid-cols-3 gap-5 lg:gap-10 lg:grid-cols-5" role="listbox" aria-labelledby="predictive-search-products">
            {%- for product in predictive_search.resources.products -%}
              <li id="predictive-search-option-{{ forloop.index }}" class="predictive-search__option py-2" role="option" aria-selected="false">
                <a href="{{ product.url }}">
                  {%- if product.featured_media != blank -%}
                    {%- render 'responsive-image' with
                      image: product.featured_media.preview_image
                    -%}
                  {%- endif -%}
                  <div class="mt-2 {{ settings.product_grid_font }} {% if settings.product_grid_align == 'center' %}text-center{% endif %}">
                    <h3 class="text-sm">
                      {% if settings.products_split_title and product.title contains '-' %}
                        {%- assign title = product.title | split: '-' -%}
                        <p class="product-grid-title">{{ title | last | strip }}</p>
                        <p class="mt-1">{{ title | first | strip }}</p>
                      {% else %}
                        <p class="product-grid-title">{{ product.title }}</p>
                      {% endif %}
                    </h3>
                  </div>
                </a>
              </li>
              {%- endfor -%}
          </ul>
        </div>
        {%- endif -%}

        {%- if columns -%}
          <div class="lg:col-span-3">
            <div class="-mt-8">
              {%- if predictive_search.resources.collections.size > 0 -%}
                <h2 class="font-secondary border-b-theme-width border-scheme-border pb-2 mt-8">
                  {{ 'general.search.collections' | t }}
                </h2>
                <ul id="predictive-search-results-list" class="mt-2 grid grid-cols-2 gap:5 lg:gap-10" role="listbox" aria-label="{{ 'general.search.collections' | t }}">
                  {%- for collection in predictive_search.resources.collections -%}
                    <li id="predictive-search-option-{{ forloop.index }}" class="predictive-search__option py-2" role="option" aria-selected="false">
                      <a href="{{ collection.url }}">
                        {%- if collection.image != blank -%}
                          {%- render 'image-crop' with
                            image: collection.image,
                            ratio: 1
                          -%}
                        {%- endif -%}
                        <div class="mt-2 text-center">
                          <h3 class="text-sm">
                            <p class="product-grid-title">{{ collection.title }}</p>
                          </h3>
                        </div>
                      </a>
                    </li>
                    {%- endfor -%}
                </ul>
              {%- endif -%}
              {%- if predictive_search.resources.articles.size > 0 -%}
                <h2 class="font-secondary border-b-theme-width border-scheme-border pb-2 mt-8">
                  {{ 'general.search.articles' | t }}
                </h2>
                <ul id="predictive-search-results-list" class="mt-2 grid  gap:5 lg:gap-10" role="listbox" aria-label="{{ 'general.search.articles' | t }}">
                  {%- for article in predictive_search.resources.articles -%}
                    <li id="predictive-search-option-{{ forloop.index }}" class="predictive-search__option py-2" role="option" aria-selected="false">
                      <a href="{{ article.url }}">
                        <div class="mt-2 {%- if article.image != blank -%}text-center{%- else -%}text-left{% endif%}">
                          <h3 class="text-base">
                            <p class="product-grid-title">{{ article.title }}</p>
                          </h3>
                        </div>
                      </a>
                    </li>
                    {%- endfor -%}
                </ul>
              {%- endif -%}
              {%- if predictive_search.resources.pages.size > 0 -%}
                <h2 class="font-secondary border-b-theme-width border-scheme-border pb-2 mt-8">
                  {{ 'general.search.pages' | t }}
                </h2>
                <ul id="predictive-search-results-list" class="mt-2 grid gap:5 lg:gap-10" role="listbox" aria-label="{{ 'general.search.pages' | t }}">
                  {%- for page in predictive_search.resources.pages -%}
                    <li id="predictive-search-option-{{ forloop.index }}" class="predictive-search__option py-2" role="option" aria-selected="false">
                      <a href="{{ page.url }}">
                        <div class="mt-2 text-left">
                          <h3 class="text-base">
                            <p class="product-grid-title">{{ page.title }}</p>
                          </h3>
                        </div>
                      </a>
                    </li>
                    {%- endfor -%}
                </ul>
              {%- endif -%}
            </div>
          </div>
        {%- endif -%}
      </div>
  </div>

  {%- if results -%}
  <div class="predictive-search__option text-center mt-8" id="predictive-search-option-search-keywords" role="option">
    <button class="btn btn-outline-primary-{{ settings.solid_button_color }} inline-flex justify-between items-center">
      {% comment %}<span class="btn-text">{{ 'general.search.search_for' | t: terms: predictive_search.terms }}</span>{% endcomment %}
      <span class="btn-text">View all results</span>
      {% if settings.buttons_show_arrow %}<span class="btn-icon">{% render 'icon-right_arrow' %}<span>{% endif %}
    </button>
  </div>
  {%- else -%}
  <div class="text-center">
    <p>{{ 'general.search.no_results' | t: terms: predictive_search.terms }}</p>
  </div>
  {%- endif -%}

  <span class="hidden" id="predictive-search-count">
    {%- if search.results_count == 0 -%}
      {{- 'general.search.no_results' | t: terms: predictive_search.terms -}}
    {%- else -%}
      {{- 'general.search.results_with_count' | t: terms: predictive_search.terms, count: predictive_search.resources.products.size -}}
    {%- endif -%}
  </span>
{%- endif -%}

{% comment %}theme-check-enable MissingTemplate{% endcomment %}

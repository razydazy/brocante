{% unless request.design_mode %}
  <script src="{{ 'cart.js' | asset_url }}" defer="defer"></script>
{% endunless %}
<section
  id="main-cart-items"
  x-data="ThemeSection_Cart()"
  x-init="mounted()"
  data-section-id="{{ section.id }}"
  data-id="{{ section.id }}"
  class="transition-opacity duration-200 ease-in-out section-y-padding"
  data-color-scheme="primary">
  <div class="js-contents">
  {% if cart.item_count > 0 %}
    <div class="section-x-padding">
      <h1 class="font-heading text-2xl mb-4">{{ 'cart.general.title' | t }}</h1>
      <form action="{{ routes.cart_url }}" method="post" novalidate id="cart">
        <table class="cart-table">
          <thead class="">
            <tr>
              <th scope="col" class="font-secondary text-scheme-meta text-sm pb-4">{{ 'cart.label.product' | t }}</th>
              <th scope="col" class="font-secondary text-scheme-meta text-sm pb-4">{{ 'cart.label.price' | t }}</th>
              <th scope="col" class="font-secondary text-scheme-meta text-sm pb-4">{{ 'cart.label.quantity' | t }}</th>
              <th scope="col" class="font-secondary text-scheme-meta text-sm pb-4">{{ 'cart.label.total' | t }}</th>
            </tr>
          </thead>
          <tbody>
            {% for item in cart.items %}
              <tr
                class=""
                x-data="{ 'quantity_{{ item.key | replace: ':', '' }}': {{ item.quantity }}, errorMessage: null, ...QuantityControls() }"
                x-init="mounted('quantity_{{ item.key | replace: ':', '' }}')"
                id="CartItem-{{ item.index | plus: 1 }}"
                @quantity-error.stop="errorMessage = $event.detail.message; resetQuantity($event, $event.detail.lastQuantity, 'quantity_{{ item.key | replace: ':', '' }}')"
                data-last-quantity="{{ item.quantity }}"
              >
                <td data-label="{{ 'customer.order.product' | t }}">
                  <div class="sm:flex sm:items-center">
                    {% if item.image != blank %}
                      <div class="w-full sm:w-20 sm:mr-4 mb-4 sm:mb-0">
                        <a href="{{ item.url | within: collections.all }}">
                          {{ item | img_url: '320x320' | img_tag: item.title }}
                        </a>
                      </div>
                    {% endif %}
                    <div>
                      <a class="block type-product-grid-item" href="{{ item.url }}">{{ item.product.title }}</a>

                      {% unless item.product.has_only_default_variant %}
                        <p class="font-secondary text-sm text-scheme-meta">{{ item.variant.title }}</p>
                      {% endunless %}

                      {% if settings.cart_vendor_enable %}
                        <p class="text-sm text-scheme-meta">{{ item.vendor }}</p>
                      {% endif %}

                      {% if item.selling_plan_allocation %}
                        <p class="text-sm text-scheme-meta">{{ item.selling_plan_allocation.selling_plan.name }}</p>
                      {% endif %}

                      {% comment %} <p class="text-sm">{{ item.vendor }}</p> {% endcomment %}

                      {%- assign property_size = item.properties | size -%}

                      {% if property_size > 0 %}
                        <div class="text-sm text-scheme-meta mt-2">
                          {% for p in item.properties %}
                            {% assign property_first_char = p.first | slice: 0 %}
                            {% if p.last != blank and property_first_char != '_' %}
                              <p>
                                {{ p.first }}:

                                {% if p.last contains '/uploads/' %}
                                  <a href="{{ p.last }}">{{ p.last | split: '/' | last }}</a>
                                {% else %}
                                  {{ p.last }}
                                {% endif %}
                              </p>
                            {% endif %}
                          {% endfor %}
                        </div>
                      {% endif %}

                      <p
                        class="text-sm my-2"
                        x-show="errorMessage"
                        x-transition:enter="transition ease duration-300"
                        x-transition:enter-start="opacity-0"
                        x-transition:enter-end="opacity-100"
                        x-transition:leave="transition ease duration-300"
                        x-transition:leave-start="opacity-100"
                        x-transition:leave-end="opacity-0"
                        style="display: none;"
                      >
                      <span
                        class="cart-item-error-text text-scheme-accent" x-text="errorMessage"></span>
                      </p>

                      <a @click.prevent="removeItem" class="inline-block text-sm text-scheme-accent mt-2" href="/cart/change?line={{ forloop.index }}&amp;quantity=0">
                        {{ 'cart.general.remove' | t }}
                      </a>
                    </div>
                  </div>
                </td>
                <td data-price data-label="{{ 'cart.label.price' | t }}">
                  {% if item.original_line_price != item.line_price %}
                    <span class="visually-hidden">{{ 'cart.label.discounted_price' | t }}</span>
                    {{ item.price | money }}
                    <span class="visually-hidden">{{ 'cart.label.original_price' | t }}</span>
                    <s>{{ item.original_price | money }}</s>
                  {% else %}
                    {{ item.price | money }}
                  {% endif %}
                  {%- if item.unit_price_measurement -%}
                    <div class="text-xs">
                      {{ item.unit_price | money }} /&nbsp;
                      {%- if item.unit_price_measurement.reference_value != 1 -%}
                        {{- item.unit_price_measurement.reference_value -}}
                      {%- endif -%}
                      {{ item.unit_price_measurement.reference_unit }}
                    </div>
                  {%- endif -%}
                </td>
                <td data-quantity data-label="{{ 'cart.label.quantity' | t }}">

                  <div class="flex  items-center justify-center">
                    <button
                      type="submit"
                      name="minus"
                      class="w-6 p-1 align-middle js-enabled"
                      @click.prevent="qtyAdjust($event, -1, 'quantity_{{ item.key | replace: ':', '' }}')"
                      :aria-label="'{{ 'general.accessibility.decrement_one' | t }} ' + '{{ item.title }}'">
                      {% render 'icon-minus' %}
                    </button>
                    <input type="text"
                      data-index="{{ item.index | plus: 1 }}"
                      x-ref="quantity"
                      name="updates[]"
                      id="updates_{{ item.key }}"
                      value="{{ item.quantity }}"
                      class="min-w-0 w-6 pb-1 text-center text-sm lg:text-base border-b-text border-current bg-transparent"
                      min="0"
                      aria-label="{{ 'cart.label.quantity' | t }}"
                      pattern="[0-9]*"
                      x-model.number="quantity_{{ item.key | replace: ':', '' }}"
                      autocomplete="off" />
                    <button
                      name="plus"
                      type="submit"
                      class="w-6 p-1 align-middle js-enabled"
                      @click.prevent="qtyAdjust($event, 1, 'quantity_{{ item.key | replace: ':', '' }}')"
                      :aria-label="'{{ 'general.accessibility.increment_one' | t }} ' + '{{ item.title }}'">
                    {% render 'icon-plus' %}
                    </button>
                  </div>

                  {% comment %}
                  <input type="text"
                    name="updates[]"
                    data-index="{{ item.index | plus: 1 }}"
                    id="updates_{{ item.key }}"
                    value="{{ item.quantity }}"
                    class="min-w-0 w-24 py-2 px-4 border-text-width border-scheme-border bg-transparent"
                    min="0"
                    aria-label="{{ 'cart.label.quantity' | t }}"
                    pattern="[0-9]*"
                    autocomplete="off"
                    @input.debounce.300ms="onChange" />
                  {% endcomment %}


                </td>
                <td data-total data-label="{{ 'cart.label.total' | t }}">
                  <div>
                    {%- if item.original_line_price != item.final_line_price -%}
                      <del class="">{{ item.original_line_price | money }}</del>
                      <span class="">{{ item.final_line_price | money }}</span>
                    {%- else -%}
                      <span>{{ item.original_line_price | money }}</span>
                    {%- endif -%}
                    {%- if item.unit_price_measurement -%}
                      <div class="text-xs">
                        {{ item.unit_price | money }} /&nbsp;
                        {%- if item.unit_price_measurement.reference_value != 1 -%}
                          {{- item.unit_price_measurement.reference_value -}}
                        {%- endif -%}
                        {{ item.unit_price_measurement.reference_unit }}
                      </div>
                    {%- endif -%}

                    {%- if item.line_level_discount_allocations != blank -%}
                      <ul class="mt-1 text-sm text-scheme-accent" aria-label="{{ 'customer.order.discount' | t }}">
                        {%- for discount_allocation in item.line_level_discount_allocations -%}
                          <li class="order-discount__item">
                            {{ discount_allocation.discount_application.title }}{% if discount_allocation.amount > 0 %} -{{ discount_allocation.amount | money }}{% endif %}
                          </li>
                        {%- endfor -%}
                      </ul>
                    {%- endif -%}
                  </div>
                </td>
              </tr>

            {% endfor %}
          </tbody>
        </table>
      <p class="visually-hidden" id="cart-live-region-text" aria-live="polite" role="status"></p>
      <p class="visually-hidden" id="shopping-cart-line-item-status" aria-live="polite" aria-hidden="true" role="status">{{ 'general.accessibility.loading' | t }}</p>
    </form>
  {% else %}
   <div class="section-x-padding text-center">
    <h1 class="font-heading {{ settings.base_heading_size }}">{{ 'cart.general.title' | t }}</h1>
    {% comment %}
    Cart empty state
    {% endcomment %}
    <div class="mt-8">
      <div class="supports-cookies">
        <p class="mb-8">{{ 'cart.general.empty' | t }}</p>
        <a class="btn btn-primary-accent" href="{{ routes.root_url }}">{{ 'cart.general.continue_shopping' | t }}</a>
      </div>

      {% comment %}
      Cart no cookies state
      ---------------------
      Browser cookies are required to use the cart. If cookies aren't enabled in the
      browser a message is displayed prompting the user to enable them.
      {% endcomment %}
      <div class="supports-no-cookies">
        <p>{{ 'cart.general.cookies_required' | t }}</p>
      </div>
    </div>
  </div>
  {% endif %}
  </div>
</section>

{% schema %}
  {
    "name": "Cart items"
  }
{% endschema %}

{% comment %}theme-check-disable MissingTemplate{% endcomment %}
{%- liquid
  assign section_color = section.settings.color_scheme
  assign blocks_modulo = section.blocks.size | modulo: 2
  assign ratio = section.settings.crop | plus: 0.0
  if section.settings.full_width and section.settings.heading == blank
    assign full_width = true
    assign section_class = 'section-with-no-padding'
  elsif section.settings.full_width and section.settings.heading != blank
    assign full_width = true
    assign section_class = 'section-t-padding section-with-no-bottom-padding'
  else
    assign section_class = 'section-y-padding'
  endif
-%}
<section class="bg-scheme-background text-scheme-text collection-list {{ section_class }}" data-color-scheme="{{ section_color }}">
  <div>
    {% if section.settings.heading != blank %}
    <div class="wrapper mb-10">
      <h2 class="font-heading section-title-align {{ settings.section_heading_font_size }}">{{ section.settings.heading | escape }}</h2>
    </div>
    {% endif %}

    <ul class="grid grid-cols-1 {% if section.blocks.size > 1 %}lg:grid-cols-2{% endif %} {% unless full_width %} {% unless section.settings.heading == blank %}mt-10{% endunless %} gap-5 lg:gap-10 wrapper{% endunless %}">
      {% for block in section.blocks %}
        {%- liquid
          assign collection = collections[block.settings.collection]
          assign default_label = 'homepage.onboarding.collection_title' | t
          assign text_color = block.settings.text_color
          assign text_size = block.settings.text_size
        -%}
        {%- capture text_markup -%}
          <div class="absolute w-full h-full z-10 top-0 left-0 flex items-center justify-center" data-fade-in>
            <div class="collection-list__text text-center flex flex-col items-center text-{{ text_color }}-text p-5">
              <h3 class="m-0 font-heading text-{{ text_size }}"><span class="type-text-overlay">{{ collection.title | default: default_label }}</pan></h3>
              <div class="mt-5 btn btn-solid-{{ text_color }}-{{ settings.solid_button_color }} cursor-pointer">
                <span class="btn-text">{{ block.settings.cta_text }}</span>
                {% if settings.buttons_show_arrow %}<span class="btn-icon">{% render 'icon-right_arrow' %}<span>{% endif %}
              </div>
            </div>
          </div>
        {% endcapture -%}
        <li class="collection-list-item relative {% if forloop.first and blocks_modulo > 0 %}lg:col-span-2{% endif %}" {{ block.shopify_attributes }}>
          <a class="group block" href="{{ collection.url | default: "#" }}">
            {% if collection.image != blank or collection.products.first.featured_image != blank %}
              {%- assign image_object = collection.image | default: collection.products.first.featured_image -%}
              <div class="collection-list__image relative">
                {% render 'image-crop' with
                  image: image_object,
                  ratio: ratio
                %}
                {{ text_markup }}
              </div>
            {% elsif collection == empty %}
              <div class="bg-placeholder-darker-bg">
                {% capture current %}{% cycle 1, 2, 3, 4, 5, 6 %}{% endcapture %}
                {{ 'collection-' | append: current | placeholder_svg_tag: 'placeholder-svg placeholder-svg--small fill-current' }}
                {{ text_markup }}
              </div>
            {% else %}
              <div class="h-40">
                {{ text_markup }}
              </div>
            {% endif %}
          </a>
        </li>
      {% endfor %}
    </ul>

    {% if section.blocks.size == 0 %}
      {% render 'no-blocks' %}
    {% endif %}
  </div>
</section>

{% schema %}
  {
    "name": "Collection list",
    "max_blocks": 12,
    "disabled_on": {
      "groups": ["header", "footer", "aside"]
    },
    "settings": [
      {
        "type": "text",
        "id": "heading",
        "label": "Heading"
      },
      {
        "type": "select",
        "id": "crop",
        "label": "Crop images",
        "options": [
          {
            "value": "0",
            "label": "No crop"
          },
          {
            "value": "1.3",
            "label": "Landscape"
          },
          {
            "value": "1",
            "label": "Square"
          },
          {
            "value": "0.8",
            "label": "Portrait"
          }
        ],
        "default": "1"
      },
      {
        "type": "checkbox",
        "id": "full_width",
        "label": "Full width",
        "default": false
      },
      {
        "type":      "header",
        "content":   "Color"
      },
      {
        "type": "select",
        "id": "color_scheme",
        "label": "Color scheme",
        "options": [
            { "value": "primary", "label": "Primary"},
            { "value": "secondary", "label": "Secondary"},
            { "value": "tertiary", "label": "Tertiary"}
        ],
        "default":   "primary"
      }
    ],
    "blocks": [
      {
        "type": "collection",
        "name": "Collection",
        "settings": [
          {
            "label": "Collection",
            "id": "collection",
            "type": "collection"
          },
          {
            "label": "Call to action text",
            "id": "cta_text",
            "type": "text",
            "default": "Shop Now"
          },
          {
            "type":      "select",
            "id":        "text_size",
            "label":     "Text size",
            "options": [
              {
                "value": "4xl",
                "label": "Large"
              },
              {
                "value": "3xl",
                "label": "Medium"
              }
            ],
            "default":   "3xl"
          },
          {
            "type": "select",
            "id": "text_color",
            "label": "Text color",
            "options": [
                { "value": "primary", "label": "Primary text"},
                { "value": "secondary", "label": "Secondary text"},
                { "value": "tertiary", "label": "Tertiary text"},
                { "value": "white", "label": "White"},
                { "value": "black", "label": "Black"}
            ],
            "default":   "white"
          }
        ]
      }
    ],
    "presets": [
      {
        "name": "Collection list",
        "blocks": [
          {
            "type": "collection"
          },
          {
            "type": "collection"
          }
        ]
      }
    ]
  }
{% endschema %}

{% comment %}theme-check-disable MissingTemplate{% endcomment %}
{%- liquid
  assign section_color = section.settings.color_scheme
  assign mode = section.settings.mode
  assign video_position = section.settings.video_position
  assign text_align = section.settings.text_alignment
  case section.settings.video_size
    when 'third'
      assign text_width_desktop = 'lg:col-span-8'
      if video_position == 'right'
        assign video_width_desktop = 'lg:col-start-9 lg:col-end-13'
      else
        assign video_width_desktop = 'lg:col-span-4'
      endif
    when 'half'
      assign text_width_desktop = 'lg:col-span-6'
      if video_position == 'right'
        assign video_width_desktop = 'lg:col-start-7 lg:col-end-13'
      else
        assign video_width_desktop = 'lg:col-span-6'
      endif
    when 'two_thirds'
      assign text_width_desktop = 'lg:col-span-4'
      if video_position == 'right'
        assign video_width_desktop = 'lg:col-start-5 lg:col-end-13'
      else
        assign video_width_desktop = 'lg:col-span-8'
      endif
  endcase

  assign video = section.settings.video_url
  if video == '' or video == blank
    assign video = 'https://www.youtube.com/watch?v=_9VUPq3SxOc'
    assign video_type = 'youtube'
    assign video_id = '_9VUPq3SxOc'
  endif
  if video contains 'youtube.com/watch'
    assign video_type = 'youtube'
    assign video_id = video | split: 'v='
    assign video_id = video_id[1] | split: '&' | first
  endif
  if video contains 'youtu.be/'
    assign video_type = 'youtube'
    assign video_id = video | split: '.be/'
    assign video_id = video_id[1] | split: '&' | first
  endif
  if video contains 'mp4'
    assign video_type = 'mp4'
  endif

  assign ratios = section.settings.aspect_ratio | split: ':'
  assign ratio = ratios[1] | plus: 0.0 | divided_by: ratios[0] | plus: 0.0 | times: 100.0
-%}

{% unless request.design_mode %}
  {% render 'script-tags', script: 'video' %}
{% endunless %}

<section class="image-with-text section-with-no-padding bg-scheme-background" data-color-scheme="primary">
  <div class="grid grid-cols-1 lg:grid-cols-12 grid-flow-row-dense">

    <div class="image-with-text__video {{ video_width_desktop }}">

      {% comment %}
      Click to play
      {% endcomment %}
      {%- if mode == 'click' -%}
      <div class="relative min-h-full" x-data='ThemeModule_Video("featuredVideo-{{ section.id }}", "external_video", "youtube")' x-init="mounted()">
        <div x-ref="video_container" style="padding-top: {{ ratio }}%;">
          <template x-if="!enabled">
            <button  @click="enableVideo()" class="absolute top-0 left-0 right-0 bottom-0 h-full w-full flex items-center justify-center  group overflow-hidden" type="button">
              <div class="z-40 text-center">
                <span
                  class="rounded-full w-14 h-14 lg:w-18 lg:h-18 bg-scheme-background text-scheme-background-overlay  inline-flex items-center justify-center hover:bg-scheme-accent hover:text-scheme-accent-overlay transition-opacity"
                >
                  <span class="w-8 h-8 lg:w-10 h-10 inline-block" >{% render 'icon-play' %}</span>
                </span>
              </div>
              {%- if section.settings.cover_image != blank -%}
                {% render 'image-object' with
                  image: section.settings.cover_image
                %}
              {%- else -%}
                <div class="bg-placeholder-bg absolute top-0 left-0 right-0 bottom-0">
                  {{ 'collection-2' | placeholder_svg_tag: 'placeholder-svg placeholder' }}
                </div>
              {%- endif -%}
            </button>
          </template>
          <template  x-if="enabled">
            {%- if video_type == 'mp4' -%}
              <video class="object-cover absolute top-0 right-0 bottom-0 left-0 w-full h-full" autoplay loop playsinline controls>
                {% comment %}theme-check-disable RemoteAsset{% endcomment %}
                <source src="{{ video }}" type="video/mp4">
                {% comment %}theme-check-enable RemoteAsset{% endcomment %}
                  Sorry, your browser doesn't support embedded videos.
              </video>
            {%- endif -%}
            {%- if video_type == 'youtube' -%}
              <iframe src="https://www.youtube.com/embed/{{ video_id }}?enablejsapi=1&autoplay=1" class="js-youtube absolute top-0 left-0 right-0 bottom-0 w-full h-full" allow="autoplay; encrypted-media" allowfullscreen></iframe>
            {%- endif -%}
          </template>
        </div>
      </div>
      {%- endif -%}

      {%- if mode == 'autoplay' -%}
        <div class="background-video-wrapper h-auto p-0  relative overflow-hidden"  style="padding-top: {{ ratio }}%;">
          {% assign component_id = 'background-video-' | append: section.id %}
          {% render 'background-video',
            extra_classes: 'video-with-text-overlay__background-video',
            video: video,
            fallback_image: section.settings.cover_image,
            component_id: component_id
        %}
        </div>
      {%- endif -%}

    </div>

    <div class="image-with-text__text  {{ text_width_desktop }} flex items-center bg-scheme-background text-scheme-text px-5 lg:px-10 section-y-padding {% if mode == 'click' %}relative{% endif %}" data-color-scheme="{{ section_color }}">
      {% if section.settings.cta_url != blank %}
      <a href="{{ section.settings.cta_url }}" class="increase-target"></a>
      {% endif %}
      <div class="{{ text_align }} break-words w-full  py-10 lg:py-20" data-fade-in>
        {% if section.settings.heading != blank %}
          <h2 class="block font-heading text-2xl lg:text-3xl lg:text-4xl leading-snug max-w-md {% if text_align == 'text-center' %}mx-auto{% endif %} {% if text_align == 'text-right' %}ml-auto{% endif %}">
            <span class="type-text-overlay">
              {{ section.settings.heading | escape }}
            </span>
          </h2>
        {% endif %}
        {% if section.settings.richtext != blank %}
          <div class="leading-relaxed text-rte rte mt-4 max-w-md {% if text_align == 'text-center' %}mx-auto{% endif %} {% if text_align == 'text-right' %}ml-auto{% endif %}">
            {{ section.settings.richtext }}
          </div>
        {% endif %}
        {% if section.settings.cta_url != blank and section.settings.cta_text != blank %}
          <div class="mt-8">
            <div class="btn btn-{{ section.settings.button_style }}-{{ section_color }}-{{ settings.outline_button_color }}">
              <span class="btn-text">{{ section.settings.cta_text }}</span>
              {% if settings.buttons_show_arrow %}<span class="btn-icon">{% render 'icon-right_arrow' %}</span>{% endif %}
            </div>
          </div>
        {% endif %}
      </div>
    </div>
  </div>
</section>
{% comment %}theme-check-enable MissingTemplate{% endcomment %}


{% schema %}
{
  "name": "Video with text",
  "disabled_on": {
    "groups": ["header", "footer", "aside"]
  },
  "settings": [
    {
      "type": "select",
      "id": "mode",
      "label": "Mode",
      "options": [
        { "value": "click", "label": "Click to play"},
        { "value": "autoplay", "label": "Autoplay"}
      ],
      "default":   "click",
      "info": "Autoplay will loop with no sound"
    },
    {
      "id": "video_url",
      "type": "text",
      "label": "Video URL",
      "info": "Accepts YouTube or .mp4 links",
      "default": "https://www.youtube.com/watch?v=_9VUPq3SxOc"
    },
    {
      "type": "image_picker",
      "id": "cover_image",
      "label": "Cover image"
    },
    {
      "type": "select",
      "id": "video_position",
      "label": "Video position on desktop",
      "default": "right",
      "options": [
        {
          "value": "right",
          "label": "Right"
        },
        {
          "value": "left",
          "label": "Left"
        }
      ]
    },
    {
      "type": "select",
      "id": "aspect_ratio",
      "label": "Aspect ratio",
      "default": "16:9",
      "options": [
        {
          "value": "16:9",
          "label": "Standard - 16:9"
        },
        {
          "value": "4:3",
          "label": "Standard - 4:3"
        },
        {
          "value": "2.39:1",
          "label": "Cinema"
        },
        {
          "value": "1:1",
          "label": "Square"
        },
        {
          "value": "9:16",
          "label": "Portrait"
        }
      ]
    },
    {
      "type": "select",
      "id": "video_size",
      "label": "Video width on desktop",
      "default": "half",
      "options": [
        {
          "value": "third",
          "label": "One third"
        },
        {
          "value": "half",
          "label": "One half"
        },
        {
          "value": "two_thirds",
          "label": "Two thirds"
        }
      ]
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Video with text"
    },
    {
      "type": "richtext",
      "id": "richtext",
      "label": "Text"
    },
    {
      "type": "select",
      "id": "text_alignment",
      "label": "Text alignment",
      "options": [
        { "value": "text-left", "label": "Left"},
        { "value": "text-center", "label": "Center"},
        { "value": "text-right", "label": "Right"}
      ],
      "default":   "text-left"
    },
    {
      "type": "header",
      "content": "Call to action"
    },
    {
      "type": "url",
      "id": "cta_url",
      "label": "Link"
    },
    {
      "type": "text",
      "id": "cta_text",
      "label": "Text",
      "default": "Shop Now"
    },
    {
      "type": "select",
      "id": "button_style",
      "label": "Button style",
      "default": "outline",
      "options": [
        {
          "value": "outline",
          "label": "Outline"
        },
        {
          "value": "solid",
          "label": "Solid"
        }
      ]
    },
    {
      "type": "header",
      "content": "Color"
    },
    {
      "type": "select",
      "id": "color_scheme",
      "label": "Color scheme",
      "options": [
          { "value": "primary", "label": "Primary"},
          { "value": "secondary", "label": "Secondary"},
          { "value": "tertiary", "label": "Tertiary"}
      ],
      "default":   "secondary"
    }
  ],
  "presets": [
    {
      "name": "Video with text"
    }
  ]
}
{% endschema %}

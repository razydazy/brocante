{% comment %}theme-check-disable MissingTemplate{% endcomment %}
{%- liquid
  assign show_date = section.settings.show_date
  assign show_author = section.settings.show_author

  assign new_comment = false
  assign number_of_comments = article.comments_count
  if comment and comment.created_at
    assign new_comment = true
    assign new_comment_id = comment.id
  endif

  if new_comment
    assign duplicate_comment = false
    for comment in article.comments
      if comment.id == new_comment_id
        assign duplicate_comment = true
        break
      endif
    endfor

    unless duplicate_comment
      assign number_of_comments = article.comments_count | plus: 1
    endunless
  endif
-%}

<section class="wrapper section-y-padding" data-color-scheme="primary">
  <div class="grid grid-cols-1  {% if settings.center_page_titles %}lg:grid-cols-12{% else %}lg:grid-cols-4{% endif %} gap-10">
    <div class=" {% if settings.center_page_titles %}lg:col-span-8 lg:col-start-3{% else %}lg:col-span-3{% endif %}">
      <article class="relative lg:grid lg:grid-cols-4 {% if settings.center_page_titles %}max-w-4xl mx-auto{% endif %} gap-10 mb-20">
        <div class="{% if settings.center_page_titles %}lg:col-span-full{% else %}lg:col-span-3 lg:col-start-2{% endif %} space-y-8 ">

          {% if article.image and section.settings.show_image %}
            <div>
              {% render 'responsive-image' with
                image: article.image
              %}
            </div>
          {% endif %}

          {% if show_date or show_author %}
            <p class="text-scheme-text {% if settings.center_page_titles %}text-center{% endif %}">
              {% if show_date %}
                <span>{{ article.published_at | time_tag: format: 'month_day_year' }}</span>
              {% endif %}
              {% if show_date and show_author %}
                <span>&#183;</span>
              {% endif %}
              {% if show_author %}
                <span>{{ 'blogs.article.by_author' | t: author: article.author }}</span>
              {% endif %}
            </p>
          {% endif %}

          {%- unless section.settings.hide_title -%}
          <h1 class="{{ settings.template_heading_size }} font-heading leading-tight {% if article.image and section.settings.show_image %}mt-8{% endif %} {% if settings.center_page_titles %}text-center{% endif %}">
            {{ article.title }}
          </h1>
         {%- endunless -%}

          <div class="rte text-rte">
            {{ article.content }}
          </div>

          {%- if article.tags.size > 0 and section.settings.show_tags -%}
            <div class="text-sm font-secondary -mx-1 {% unless settings.center_page_titles %}lg:hidden{% endunless %}">
              <ul class="">
                {% for tag in article.tags %}
                  <li class="inline-block">
                    <a class="hover:text-scheme-accent p-1 inline-block" href="{{ blog.url }}/tagged/{{ tag | handle }}">#{{ tag }}</a>{% unless forloop.last %}&nbsp;{% endunless %}
                  </li>
                {% endfor %}
              </ul>
            </div>
          {%- endif -%}

          {%- if section.settings.show_share_buttons -%}
          <div class="{% unless settings.center_page_titles %}lg:hidden{% endunless %}">
            {% comment %}theme-check-disable LiquidTag{% endcomment %}
            {% render 'social-sharing', share_title: article.title, share_permalink: article.url, share_image: article.image, section_color: 'primary' %}
            {% comment %}theme-check-enable LiquidTag{% endcomment %}
          </div>
          {%- endif -%}

        </div>
        <div class="blog__post-sidebar hidden lg:block text-scheme-text lg:col-start-1 space-y-8 {% if settings.center_page_titles %}lg:hidden{% endif %}">
          {%- if article.tags.size > 0 and section.settings.show_tags %}
            <div class="text-sm -mx-1  font-secondary ">
              <ul class="">
                {% for tag in article.tags %}
                  <li class="inline-block">
                    <a class="p-1 inline-block hover:text-scheme-accent " href="{{ blog.url }}/tagged/{{ tag | handle }}">#{{ tag }}</a>{% unless forloop.last %}&nbsp;{% endunless %}
                  </li>
                {% endfor %}
              </ul>
            </div>
          {%- endif -%}
          {% comment %}theme-check-disable LiquidTag{% endcomment %}
          {%- if section.settings.show_share_buttons -%}
            {% render 'social-sharing', share_title: article.title, share_permalink: article.url, share_image: article.image, section_color: 'primary', no_margin: true %}
          {%- endif -%}
          {%- if blog.comments_enabled? -%}
            <a href="#comments" class="hidden lg:inline-block text-sm">
              {{ 'blogs.comments.comments_with_count' | t: count: article.comments_count }}
            </a>
          {%- endif -%}
          {% comment %}theme-check-enable LiquidTag{% endcomment %}
        </div>
        <div class="{% if settings.center_page_titles %}lg:col-span-full{% else %}lg:col-span-3 lg:col-start-2{% endif %}">
          {% if section.settings.show_next_previous_links and blog.next_article or blog.previous_article %}
            <div class="my-12 grid grid-cols-2 py-8 border-t-theme-width border-b-theme-width border-scheme-border font-secondary text-sm">
              <div class="text-left">
                {% if blog.previous_article %}
                  <a class="text-scheme-meta hover:text-scheme-accent" href="{{ blog.previous_article }}">
                    <span class="inline-block align-middle w-5">{% render 'icon-back' %}</span>
                    <span class="inline-block align-middle">{{ 'blogs.article.older_post' | t }}</span>
                  </a>
                {% endif %}
              </div>

              <div class="text-right">
                {% if blog.next_article %}
                  <a class="text-scheme-meta hover:text-scheme-accent" href="{{ blog.next_article }}">
                    <span class="inline-block align-middle">{{ 'blogs.article.newer_post' | t }}</span>
                    <span class="inline-block align-middle w-5">{% render 'icon-forward' %}</span>
                  </a>
                {% endif %}
              </div>
            </div>
          {% endif %}
          {% if blog.comments_enabled? %}
            <h3 class="font-heading text-lg">{{ 'blogs.comments.comments_with_count' | t: count: number_of_comments }}</h3>

            {% paginate article.comments by 5 %}

              <div id="comments">
                {% if comment and comment.status and comment.id != blank and paginate.current_page == 1 %}
                  <p class="py-8 form-success">
                    {% if blog.moderated? and comment.status != 'published' %}
                      {{ 'blogs.comments.success_moderated' | t }}
                    {% else %}
                      {{ 'blogs.comments.success' | t }}
                    {% endif %}
                  </p>
                {% endif %}

                {% if number_of_comments > 0 %}
                  <ul>
                    {% assign comment_classes = "py-12" %}
                    {% assign date_classes = "mt-4 font-secondary text-scheme-meta text-sm" %}
                    {% comment %}
                      Display comment from URL parameters if it is waiting moderation
                      We added "comment.id" check to make sure we don't display markup if there are form errors
                    {% endcomment %}
                    {% if comment and comment.status != 'published' and comment.id != blank %}
                      <li class="{{ comment_classes }} border-b-theme-width border-scheme-border" id="{{ comment.id }}">
                        <div class="rte">
                          {{ comment.content }}
                        </div>
                        {% capture date %}{{ comment.created_at | time_tag: format: 'month_day_year' }}{% endcapture %}
                        <p class="{{ date_classes }}">{{ 'blogs.article.comment_meta_html' | t: author: comment.author, date: date }}</p>
                      </li>
                    {% endif %}

                    {% for comment in article.comments %}
                      <li class="{{ comment_classes }} {% unless forloop.last %}border-b-theme-width border-scheme-border{% endunless %}" id="{{ comment.id }}">
                        <div class="rte">
                          {{ comment.content }}
                        </div>
                        {% capture date %}{{ comment.created_at | time_tag: format: 'month_day_year' }}{% endcapture %}
                        <p class="{{ date_classes }}">{{ 'blogs.article.comment_meta_html' | t: author: comment.author, date: date }}</p>
                      </li>
                    {% endfor %}
                  </ul>

                  {% render 'pagination' with paginate: paginate %}
                {% endif %}
              </div>

              <div class="pt-12">
                {% form 'new_comment', article %}
                  <h2 class="mb-8 font-heading text-base">{{ 'blogs.comments.title' | t }}</h3>

                  <div>
                  {{ form.errors | default_errors }}
                  </div>

                  <div class="lg:grid lg:grid-cols-2 lg:gap-10">
                    {% assign input_classes = 'w-full mb-8 p-2 border-text-width border-scheme-border bg-transparent' %}
                    {% assign label_class = 'font-secondary py-2 inline-block' %}
                    <div>
                      <label for="CommentAuthor" class="label-hidden {{ label_class }}">
                        {{ 'blogs.comments.name' | t }}
                      </label>
                      <input type="text"
                            name="comment[author]"
                            id="CommentAuthor"
                            class="{{ input_classes }} {% if form.errors contains 'author' %}border-scheme-accent{% endif %}"
                            value="{{ form.author }}"
                            autocapitalize="words">

                      <label for="CommentEmail" class="label-hidden {{ label_class }}">
                        {{ 'blogs.comments.email' | t }}
                      </label>
                      <input type="email"
                            name="comment[email]"
                            id="CommentEmail"
                            class="{{ input_classes }} lg:mb-0 {% if form.errors contains 'email' %}input-error{% endif %}"
                            value="{{ form.email }}"
                            spellcheck="false"
                            autocomplete="off"
                            autocapitalize="off">
                    </div>
                    <div>
                      <label for="CommentBody" class="label-hidden {{ label_class }}">
                        {{ 'blogs.comments.message' | t }}
                      </label>
                      <textarea
                        name="comment[body]"
                        id="CommentBody"
                        rows="4"
                        class="{{ input_classes }}  {% if form.errors contains 'body' %}input-error{% endif %}">
                        {{- form.body -}}
                      </textarea>
                    </div>

                  <div class="lg:col-span-2">
                    {% if blog.moderated? %}
                      <p class="mb-4">{{ 'blogs.comments.moderated' | t }}</p>
                    {% endif %}
                    <input type="submit" class="btn btn-primary-accent w-auto" value="{{ 'blogs.comments.post' | t }}">
                  </div>
                {% endform %}
              </div>

            {% endpaginate %}
          {% endif %}
        </div>
      </article>
    </div>
  </div>
</section>
{% comment %}theme-check-enable MissingTemplate{% endcomment %}

<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Article",
  "articleBody": "{{ article.content | strip_html }}",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "{{ shop.url }}{{ page.url }}"
  },
  "headline": "{{ article.title }}",
  {% if article.excerpt != blank %}
    "description": "{{ article.excerpt | strip_html }}",
  {% endif %}
  {% if article.image %}
    {% assign image_size = article.image.width | append: 'x' %}
    "image": [
      "https:{{ article | img_url: image_size }}"
    ],
  {% endif %}
  "datePublished": "{{ article.published_at | date: '%Y-%m-%dT%H:%M:%SZ' }}",
  "dateCreated": "{{ article.created_at | date: '%Y-%m-%dT%H:%M:%SZ' }}",
  "author": {
    "@type": "Person",
    "name": "{{ article.author }}"
  },
  "publisher": {
    "@type": "Organization",
    {% if settings.share_image %}
      {% assign image_size = settings.share_image.width | append: 'x' %}
      "logo": {
        "@type": "ImageObject",
        "height": "{{ settings.share_image.height }}",
        "url": "https:{{ settings.share_image | img_url: image_size }}",
        "width": "{{ settings.share_image.width }}"
      },
    {% elsif article.image %}
      {% assign image_size = article.image.width | append: 'x' %}
      "logo": {
        "@type": "ImageObject",
        "height": "{{ article.image.height }}",
        "url": "https:{{ article.image | img_url: image_size }}",
        "width": "{{ article.image.width }}"
      },
    {% endif %}
    "name": "{{ shop.name }}"
  }
}
</script>


{% schema %}
{
  "name": "Article page",
  "settings": [
    {
      "type": "checkbox",
      "id": "hide_title",
      "label": "Hide title"
    },
    {
      "type": "checkbox",
      "id": "show_image",
      "label": "Show image",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "show_author",
      "label": "Show author",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_date",
      "label": "Show date",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_share_buttons",
      "label": "Show social media sharing buttons",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_tags",
      "label": "Show tags",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_next_previous_links",
      "label": "Show links to next / previous articles",
      "default": true
    }
  ]
}
{% endschema %}

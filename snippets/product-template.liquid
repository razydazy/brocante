{% comment %}theme-check-disable MissingTemplate,TemplateLength,LiquidTag{% endcomment %}
{%- liquid
  if section_color == '' or section_color == blank
    assign section_color = 'primary'
  endif
  assign current_variant = product.selected_or_first_available_variant
  assign featured_media = current_variant.featured_media | default: product.featured_media
  if section.settings.enable_image_zoom
    render 'photoswipe'
  endif

  for media in product.media
    if media.media_type != 'image'
      assign has_interactive_media = true
      break
    endif
  endfor

  assign has_buy_it_with = false
  assign buy_it_with_block = section.blocks | where: "type", "buy_it_with" |  first

  if buy_it_with_block.settings.product_list != blank and buy_it_with_block.settings.heading != blank
    assign has_buy_it_with = true
  endif

  assign layout = section.settings.layout
  if layout == 'full_width_thumbnails_bottom' or layout == 'full_width_thumbnails_left' or layout == 'full_width' or template == "product.quickbuy"
    assign image_column_width = 'col-span-1 lg:col-span-7'
    assign main_column_width = 'col-span-1 lg:col-span-5'
  elsif layout == 'narrow_width_thumbnails_bottom' or 'narrow_width'
    if has_buy_it_with
      assign image_column_width = 'col-span-1 lg:col-span-5'
      assign main_column_width = 'col-span-1 lg:col-span-5'
    else
      assign image_column_width = 'col-span-1 lg:col-span-5 lg:col-start-2'
      assign main_column_width = 'col-span-1 lg:col-span-5'
    endif
  endif

  assign thumbnail_layout = section.settings.thumbnail_layout
  if thumbnail_layout == 'fixed_size'
    assign thumbnail_wrapper_class = 'flex flex-wrap justify-center -ml-4'
    assign thumbnail_class = 'product__thumbnail-item ml-4 mb-4'
    assign thumbnail_width = '160x'
  elsif thumbnail_layout == 'fit_image'
    if product.media.size > 8
      assign thumbnail_wrapper_class = 'grid gap-4 grid-cols-8'
    else
      assign thumbnail_wrapper_class = 'grid gap-4 grid-cols-' | append: product.media.size
    endif
    assign thumbnail_width = '320x'
  endif

  assign hide_first_video = section.settings.hide_first_video
  if hide_first_video
    assign product_videos = product.media | where: "media_type", "video"
    assign external_videos = product.media | where: "media_type", "external_video"
    assign videos = product_videos | concat: external_videos
    assign featured_video = videos | sort: 'position' | first
    assign featured_video_is_featured_image = false
    if featured_media.id == featured_video.id
      assign featured_video_is_featured_image = true
    endif
  endif

  assign section_class = 'section-y-padding'
  if section.settings.mobile_layout == 'full_width'
    assign section_class = 'pb-8 lg:py-16'
  endif

  assign audio_blocks_size = section.blocks | where: 'type', 'audio_player' | size
  assign popup_blocks = section.blocks | where: 'type', 'popup'

  assign product_modal = false
  if template == "product.quickbuy"
    assign feature_product_section = true
    assign product_modal = true
  endif
-%}


{% unless request.design_mode %}
  {% if audio_blocks_size > 0 %}
    {% render 'script-tags', script: 'audio-player' %}
  {% endif %}
{% endunless %}

{% if has_buy_it_with and settings.product_grid_item_star_ratings != 'none' %}
  {% capture selector %}[data-section-id="{{ section.id }}"]{% endcapture %}
  {% render 'star-style',
     selector: selector,
     section_color: section_color
  %}
{% endif %}

<section
  class="product-section section {{ section_class }} bg-scheme-background text-scheme-text {% if section.settings.mobile_layout == 'full_width' %}section-with-no-padding-mobile{% endif %}"
  x-data="ThemeSection_{{ section.id | handleize | replace: '-', '_' }}()"
  x-init="mounted()"
  data-color-scheme="{{ section_color }}"
  data-section-id="{{ section.id }}"
  data-alpine-id="{{ section.id | handleize | replace: '-', '_' }}"
  data-product-handle="{{ product.handle }}"
  data-section-type="product"
  data-enable-history-state="true"
  data-enable-image-zoom={{ section.settings.enable_image_zoom | json }}
  data-product-modal="{{ product_modal | json }}"
>

  {%- if section_title != blank -%}
    <h2 class="font-heading section-title-align {{ settings.section_heading_font_size }}">
      <div>
        {{ section_title }}
      </div>
    </h2>
  {%- endif -%}

  <div class="wrapper grid grid-cols-1 lg:grid-cols-12 gap-10 {% if section_title != blank %}mt-10{% endif %}">

    <div class="{{ image_column_width }}" data-fade-in>
      <div class="{% if layout == 'full_width_thumbnails_left' and product.media.size > 1 %}lg:grid grid-cols-7 gap-{% endif %} relative">
        {% if layout == 'full_width_thumbnails_left' %}
          {% if product.media.size > 1 %}
            <div class="hidden lg:block absolute top-0 left-0 bottom-0 lg:w-1/7" x-ref="productLeftThumbnails">
              <div x-ref="productLeftThumbnailsScrollContainer" class="overflow-y-scroll max-h-full pr-5">
                <ul>
                  {% for media in product.media %}
                    {% unless hide_first_video and media.id == featured_video.id %}
                      <li class="product-single__thumbnail-item mb-4">
                        <button
                            @click="updateMedia({{ media.id }}, '{{ media.media_type }}')"
                            class="product-single__thumbnail relative cursor-pointer"
                            data-thumbnail-id="{{ media.id }}"
                            :class="{ 'border border-scheme-text': current_media_id === {{ media.id }}, 'border border-transparent': current_media_id !== {{ media.id }} }"
                            data-product-single-thumbnail
                          >
                          <img class="block product-single__thumbnail-image" src="{{ media.preview_image | img_url: '160x160' }}" width="160" height="160" alt="{% if media.preview_image.alt != blank %}{{ media.preview_image.alt | escape }}{% else %}{{ 'products.media.media' | t }} {{ forloop.index }}{% endif %}">
                          <div class="absolute w-6 bg-scheme-background top-1 right-1">
                            {% if media.media_type == 'video' or media.media_type == 'external_video' %}
                              <div class="opacity-70">{% render 'icon-video' %}</div>
                            {% elsif media.media_type == 'model' %}
                              <div class="opacity-70">{% render 'icon-3d-model' %}</div>
                            {% endif %}
                          </div>
                        </button>
                      </li>
                    {% endunless %}
                  {% endfor %}
                </ul>
              </div>
              <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-scheme-background to-transparent h-24">
              </div>
            </div>

          {% endif %}
        {% endif %}

        <div class="{% if layout == 'full_width_thumbnails_left' and product.media.size > 1 %}lg:col-span-6 lg:col-start-2{% endif %}" data-product-single-media-group>
          {%- if product_modal -%}
            {%- for media in product.media -%}
              <div class="w-full" x-show="current_media_id === {{ media.id }}">
              {% render 'responsive-image' with
                image: media.preview_image,
                image_attributes: "data-product-featured-image",
                wrapper_attributes: "data-product-image-wrapper"
              %}
              </div>
            {%- endfor -%}
          {%- else -%}
            {%- liquid
              assign has_interactive_media = false
              assign image_index = 0
              assign counter = 0
              for media in product.media
                if media.media_type != 'image'
                  assign has_interactive_media = true
                  break
                endif
              endfor

              if hide_first_video and videos.size == 1
              	assign has_interactive_media = false
              endif
            -%}
            {% if product.media.size > 1 %}
            <div class="{% if section.settings.mobile_layout == 'full_width' %}-mx-5 lg:mx-0{% endif %}">
            <div id="productSplide" class="splide" x-ref="productPageSplide" data-drag-disabled="{{ has_interactive_media }}" @mouseleave="splideHover = false" @mouseover="splideHover = true">
              <div class="splide__track relative transition-max-height" x-ref="productSplideTrack">
                <ol class="splide__list">
                {% for media in product.media %}
                  {% unless hide_first_video and media.id == featured_video.id %}
                  {%- liquid
                    if image_index == 0 and featured_video_is_featured_image
                      assign featured_media = media
                    endif
                  -%}
                  <li class="splide__slide" data-index="{{ counter }}" {% if featured_media.id == media.id %}x-ref="featuredMedia"{% endif %}>
                      <div  class="product-media-object max-w-full relative product-media-height"

                            data-media-id="{{ media.id }}"
                            data-product-single-media-wrapper
                            {% if media.media_type == 'image' %}
                            data-product-media-type-image data-product-image-index="{{ image_index }}"
                            {% if section.settings.enable_image_zoom %}
                              @click.prevent="openZoom({{ image_index }})" @keyup.space.prevent="openZoom({{ image_index }})" @keyup.enter.prevent="openZoom({{ image_index }})" tabindex="0" role="button"
                            {% endif %}
                            {% endif %}
                            {% if media.media_type == 'video' or media.media_type == 'external_video' %} role="figure" data-product-media-type-video data-enable-video-looping="{{ section.settings.enable_video_looping }}"{% endif %}
                            {% if media.media_type == 'model' %} data-product-media-type-model{% endif %}
                            {% if media.media_type == 'external_video' %} data-video-id="{{ media.external_id }}"{% endif %}>


                          {%- if media.media_type == 'image' -%}
                            {% render 'responsive-image' with
                              image: media.preview_image,
                              image_attributes: "data-product-featured-image",
                              wrapper_attributes: "data-product-image-wrapper"
                            %}
                            {% assign image_index = image_index | plus: 1 %}
                          {%- else -%}
                            {%- if media.media_type == 'model' -%}
                              <div class="relative w-full" style="padding-top: 100%">
                                <div class="absolute top-0 left-0 w-full h-full">
                                  {{ media | model_viewer_tag: image_size: '1000x', reveal: 'interaction', toggleable: true, data-model-id: media.id, image_size: '300x300' }}
                                </div>
                              </div>
                            {%- else -%}
                            {%- assign featured_video = media -%}
                            {% unless request.design_mode %}
                              {% render 'script-tags', script: 'video' %}
                            {% endunless %}

                            {%- unless product_modal -%}
                            <div x-data='ThemeModule_Video("productFeaturedVideo-{{ section.id }}", {{ featured_video.media_type | json }}, {{ featured_video.host | json }}, {{ section.settings.autoplay_videos_on_desktop | json }})' x-init="mounted()">
                              <div x-ref="video_container" class="relative" style="padding-top: {{ 1 | divided_by: featured_video.aspect_ratio | times: 100 }}%">
                                <template x-if="!enabled">
                                  <button  @click="enableVideo()" class="absolute top-0 left-0 right-0 bottom-0 h-full w-full" type="button">
                                    <span
                                      class="z-40 absolute top-1/2 left-1/2 transform -translate-y-1/2 -translate-x-1/2 rounded-full w-14 h-14 lg:w-18 lg:h-18 bg-scheme-background text-scheme-background-overlay  flex items-center justify-center hover:bg-scheme-accent hover:text-scheme-accent-overlay transition-opacity"
                                    >
                                      <span class="w-8 h-8 lg:w-10 h-10 inline-block" >{% render 'icon-play' %}</span>
                                    </span>
                                    {% render 'image-object' with
                                      image: featured_video.preview_image
                                    %}
                                  </button>
                                </template>
                                <template x-if="enabled">
                                  {%- liquid
                                    assign video_class = 'video absolute top-0 left-0 right-0 bottom-0 h-full w-full js-'
                                    case featured_video.media_type
                                    when 'external_video'
                                      assign video_class = video_class | append: featured_video.host
                                      if featured_video.host == 'youtube'
                                        echo featured_video | external_video_url: enablejsapi: 1, autoplay: true, loop: section.settings.enable_video_looping, playlist: featured_video.external_id | external_video_tag: class: video_class, loading: "lazy"
                                      else
                                        echo featured_video | external_video_url: autoplay: true, loop: section.settings.enable_video_looping | external_video_tag: class: video_class, loading: "lazy"
                                      endif
                                    when 'video'
                                      echo featured_video | media_tag: image_size: "2048x", autoplay: true, loop: section.settings.enable_video_looping, controls: true, preload: "none", autoplay: true, class: video_class, muted: false
                                    endcase
                                  -%}
                                </template>
                              </div>
                            </div>
                            {%- else -%}
                              {% render 'responsive-image' with
                                image: media.preview_image,
                                image_attributes: "data-product-featured-image",
                                wrapper_attributes: "data-product-image-wrapper"
                              %}
                              {% assign image_index = image_index | plus: 1 %}
                            {%- endunless -%}
                            {%- endif -%}
                          {%- endif -%}
                      </div>
                      {% assign counter = counter | plus: 1 %}
                      {% endunless %}
                  </li>
                  {% endfor %}
                </ol>
              </div>
              <div :class="{ 'lg:opacity-100': splideHover  }" class="js-enabled transition-opacity splide__arrows  absolute bottom-0 right-0 lg:bottom-auto lg:w-full lg:top-1/2 lg:left-0 transform translate-x-0 translate-y-0 lg:transform lg:-translate-y-1/2  flex lg:justify-between lg:opacity-0 pointer-events-none">
                <button class="block splide__arrow splide__arrow--prev bg-scheme-background text-scheme-text p-4 pointer-events-auto">
                  <span class="visually-hidden">{{ 'sections.slideshow.previous_slide' | t }}</span>
                  <span class="block transform rotate-180 w-5 h-5 lg:w-8 lg:h-8">
                    {% render 'icon-chevron-right' %}
                  </span>
                </button>
                <button class="block splide__arrow splide__arrow--next  bg-scheme-background text-scheme-text p-4 pointer-events-auto">
                  <span class="visually-hidden">{{ 'sections.slideshow.next_slide' | t }}</span>
                  <span class="block w-5 h-5 lg:w-8 lg:h-8">
                    {% render 'icon-chevron-right' %}
                  </span>
                </button>
              </div>
            </div>
            </div>
            {%- else -%}
              {%- assign media = featured_media -%}
              <div  class="product-media-object max-w-full relative product-media-height"
                    data-media-id="{{ media.id }}"
                    data-product-single-media-wrapper
                    {% if media.media_type == 'image' %}
                    data-product-media-type-image data-product-image-index="{{ image_index }}"
                    {% if section.settings.enable_image_zoom %}
                      @click.prevent="openZoom({{ image_index }})" @keyup.space.prevent="openZoom({{ image_index }})" @keyup.enter.prevent="openZoom({{ image_index }})" tabindex="0" role="button"
                    {% endif %}
                    {% endif %}
                    {% if media.media_type == 'video' or media.media_type == 'external_video' %} role="figure" data-product-media-type-video data-enable-video-looping="{{ section.settings.enable_video_looping }}"{% endif %}
                    {% if media.media_type == 'model' %} data-product-media-type-model{% endif %}
                    {% if media.media_type == 'external_video' %} data-video-id="{{ media.external_id }}"{% endif %}>
                  {% case media.media_type %}
                    {% when 'image' %}
                      {% render 'responsive-image' with
                        image: media.preview_image,
                        image_attributes: "data-product-featured-image",
                        wrapper_attributes: "data-product-image-wrapper"
                      %}
                      {% assign image_index = image_index | plus: 1 %}
                    {% when 'external_video' %}
                        <div class="relative" style="padding-top: {{ 1 | divided_by: media.aspect_ratio | times: 100 }}%;" >
                          <div class="absolute top-0 left-0 w-full h-full">
                            {{ media | external_video_tag }}
                          </div>
                        </div>
                    {% when 'video' %}
                      <div>
                        {{ media | video_tag: controls: true, image_size: '1000x1000' }}
                      </div>
                    {% when 'model' %}
                      <div class="relative w-full" style="padding-top: 100%">
                        <div class="absolute top-0 left-0 w-full h-full">
                          {{ media | model_viewer_tag: image_size: '1000x', reveal: 'interaction', toggleable: true, data-model-id: media.id, image_size: '1000x1000' }}
                        </div>
                      </div>
                  {% endcase %}
              </div>
            {%- endif -%}

            {% assign first_3d_model = product.media | where: "media_type", "model" | first %}
            {%- if first_3d_model -%}
              <div class="mt-4 text-center">
                <button aria-label="{{ 'products.media.view_in_your_space_label' | t }}"
                        class="product-single__view-in-space btn btn-{{ section_color }}-accent"
                        data-shopify-xr
                        data-shopify-model3d-id="{{ first_3d_model.id }}"
                        data-shopify-title="{{ product.title }}"
                        data-shopify-xr-hidden>
                  <span class="inline-block w-6 align-middle">{% render 'icon-3d-model' %}</span><span class="text-sm">{{ 'products.media.view_in_your_space' | t }}</span>
                </button>
              </div>
            {%- endif -%}

            {% if product.media.size > 1 and  feature_product_section == false %}
              <ul class="{% if layout contains 'thumbnails_left' %}lg:hidden{% endif %} {% if section.settings.show_thumbnails_on_mobile %}block{% else %}hidden lg:grid{% endif %}  mt-4 {{ thumbnail_wrapper_class }} ">
                {% for media in product.media %}
                  {% unless hide_first_video and media.id == featured_video.id %}
                    <li class="{{ thumbnail_class }}">
                      <button
                        @click="updateMedia({{ media.id }}, '{{ media.media_type }}')"
                        class="product-single__thumbnail relative cursor-pointer"
                        :class="{ 'border border-scheme-text': current_media_id === {{ media.id }}, 'border border-transparent': current_media_id !== {{ media.id }} }"
                        data-thumbnail-id="{{ media.id }}"
                        data-product-single-thumbnail>
                        <img class="block product-single__thumbnail-image" src="{{ media.preview_image | img_url: thumbnail_width }}" width="160" height="160" alt="{% if media.preview_image.alt != blank %}{{ media.preview_image.alt | escape }}{% else %}{{ 'products.media.media' | t }} {{ forloop.index }}{% endif %}">
                        <div class="absolute w-6 bg-scheme-background top-1 right-1">
                          {% if media.media_type == 'video' or media.media_type == 'external_video' %}
                            <div class="opacity-70">{% render 'icon-video' %}</div>
                          {% elsif media.media_type == 'model' %}
                            <div class="opacity-70">{% render 'icon-3d-model' %}</div>
                          {% endif %}
                        </div>
                      </button>
                    </li>
                  {% endunless %}
                {% endfor %}
              </ul>
            {% endif %}

            {% if section.settings.mobile_layout == 'full_width' %}
            <style>
              @media (max-width: 1023px) {
                #main-breadcrumbs {
                  display: none;
                }
              }
            </style>
            <div class=" -mx-5 pt-5 lg:hidden">
              {% render 'breadcrumbs', section_color: section_color %}
            </div>
            {% endif %}
          {%- endif-%}
        </div>
      </div>
    </div>


    <div class="{{ main_column_width }} {% if layout contains 'narrow_width' and has_buy_it_with == true %}xl:pl-6 xl:pr-16{% else %}xl:pl-10{% endif %} {% if feature_product_section %}flex items-center{% endif %}" data-fade-in>

      <div class="product__block-wrapper xl:max-w-xl xl:mx-auto {% if feature_product_section %}w-full{% endif %}" data-fade-in>
        {%- assign product_form_id = 'product-form-' | append: section.id -%}
        {%- for block in section.blocks -%}
          {%- case block.type -%}
            {%- when '@app' -%}
              <div class="mt-8">
              {%- render block -%}
              </div>
            {%- when 'title' -%}
              <h1 {{ block.shopify_attributes }} class="product-title">
                {%- if feature_product_section -%}
                <a href="{{ product.url }}">
                {%- endif -%}
                {% if settings.products_split_title and product.title contains '-' %}
                  {%- assign title = product.title | split: '-' -%}
                  <p class="font-body text-lg">{{ title | first | strip }}</p>
                  <p class="mt-2 {{ settings.template_heading_size }} font-heading leading-tight">{{ title | last | strip }}</p>
                {% else %}
                  {% assign metafield = settings.product_additional_metafield %}
                  {% if product.metafields.label_theme[metafield] != blank and settings.show_product_grid_metafield_product_page %}
                    <p class="font-body text-lg mb-2">{{ product.metafields.label_theme[metafield].value}}</p>
                  {%- endif -%}
                  <p class="{{ settings.template_heading_size }} font-heading leading-tight">{{ product.title }}</p>
                {% endif %}
                {%- if feature_product_section -%}
                </a>
                {%- endif -%}
              </h1>
            {%- when 'vendor' -%}
              {%- liquid
                assign use_collection_vendor_link = false
                for collection in product.collections
                if collection.title == product.vendor
                  assign use_collection_vendor_link = true
                  assign vendor_collection = collection
                  break
                endif
                endfor
              -%}
              {%- if use_collection_vendor_link -%}
                <p {{ block.shopify_attributes }} class="my-2 text-lg">
                  <a class="" href="{{ vendor_collection.url }}">{{ vendor_collection.title }}</a>
                </p>
              {%- else -%}
                <p {{ block.shopify_attributes }} class="my-2 text-lg">{{ product.vendor | link_to_vendor }}</p>
              {%- endif -%}
            {%- when 'price' -%}
              <div {{ block.shopify_attributes }} data-price-wrapper class="my-3 text-xl" :class="{ 'invisible': !current_variant }">
                <span class="visually-hidden">{{ 'products.general.regular_price' | t }}</span>
                <span class="text-scheme-accent" data-product-price x-html="formatMoney(current_price)" :class="{ 'text-scheme-accent': current_variant && product.compare_at_price_max && current_variant.compare_at_price > current_variant.price, 'invisible': !current_variant }">
                  {{ current_variant.price | money }}
                </span>

                {% if product.compare_at_price_max > product.price %}
                <template x-if="current_variant && product.compare_at_price_max && current_variant.compare_at_price > current_variant.price">
                  <span>
                    <span class="visually-hidden">{{ 'products.general.sale_price' | t }}</span>
                    <s data-compare-price
                      class="text-scheme-meta"
                      x-html="formatMoney(current_variant.compare_at_price)">
                      {% if current_variant.compare_at_price > current_variant.price %}
                        {{ current_variant.compare_at_price | money }}
                      {% endif %}
                    </s>
                  </span>
                </template>
                {% endif %}
              </div>

              <template x-if="current_variant && current_variant.unit_price">
                <div class="text-sm" data-unit-price-wrapper>
                  <span class="visually-hidden">
                    {{- 'products.product.unit_price_label' | t -}}
                  </span>
                  <span x-html="formatMoney(current_variant.unit_price)">
                    {{- current_variant.unit_price | money -}}
                  </span>
                  <span aria-hidden="true">
                    /
                  </span>
                  <span class="visually-hidden">
                    {{- 'general.accessibility.unit_price_separator' | t -}}
                  </span>
                  <span x-html="current_variant.unit_price_measurement.reference_value != 1? current_variant.unit_price_measurement.reference_value :''">
                    {%- if current_variant.unit_price_measurement.reference_value != 1 -%}
                      {{- current_variant.unit_price_measurement.reference_value -}}
                    {%- endif -%}
                  </span><!--
                  --><span x-html="current_variant.unit_price_measurement.reference_unit">
                    {{- current_variant.unit_price_measurement.reference_unit -}}
                  </span>
                </div>
              </template>
            {%- when 'variant_picker' -%}
              {%- liquid
                assign option_style = block.settings.option_style
                if block.settings.hide_option_labels
                  assign label_class = 'visually-hidden'
                else
                  assign label_class = 'block font-secondary text-scheme-meta text-sm'
                endif
              -%}
              {% unless product.has_only_default_variant %}
                {% for option in product.options_with_values %}
                  {% liquid
                    if settings.enable_color_swatches
                      assign is_color = false
                      assign swatch_trigger = 'products.product.color_swatch_trigger' | t | downcase
                      assign option_downcase = option.name | downcase
                      if option_downcase contains swatch_trigger
                        assign is_color = true
                      elsif swatch_trigger == 'color' and option_downcase contains 'colour'
                        assign is_color = true
                      endif
                    endif
                  %}
                  {% assign option_array_index = forloop.index0 %}

                  <fieldset class="product-variant-picker-block js-enabled my-8">
                    {%- unless is_color or option_style == 'buttons' -%}
                      <label class="{{ label_class }}" for="Option{{ option.position }}">
                        {{ option.name }}:
                      </label>
                      <select
                        id="Option{{ option.position }}-{{ section.id }}"
                        name="options[{{ option.name | escape }}]"
                        @change="optionChange()"
                        class="single-option-selector font-body text-base text-scheme-text"
                        data-single-option-selector>
                        {% for value in option.values %}
                          <option
                            value="{{ value | escape }}"
                            data-handle="{{ value | handleize }}"
                            {% if option.selected_value == value %}selected="selected"{% endif %}>
                              {{ value }}
                          </option>
                        {% endfor %}
                      </select>
                    {%- else -%}
                      <legend class="{{ label_class }}">
                        {{ option.name }}{% if is_color %}: <span x-text="options[{{ forloop.index0 }}]"></span>{% endif %}
                      </legend>
                      <div class="-mx-1">
                        {% for value in option.values %}
                          {%- liquid
                            assign variant_label_state = true
                            if product.options.size == 1
                              unless product.variants[forloop.index0].available
                                assign variant_label_state = false
                              endunless
                            endif
                            assign color_image = value | handle | append: '.' | append: 'png' | file_img_url: '50x' | prepend: 'https:'
                            assign color_swatch_fallback = value | split: ' ' | last | handle
                          -%}
                          <div class="inline-block mx-1 mt-2 relative variant-input">
                            <input class="custom-input {% if is_color %}color-swatch{% endif %} cursor-pointer absolute top-0 left-0 w-full h-full opacity-0" @change="optionChange()" type="radio" id="Option{{ option.position }}-{{ value | escape }}" name="options[{{ option.name }}]" value="{{ value | escape }}" data-handle="{{ value | handleize }}" {% if option.selected_value == value %} checked{% endif %} data-single-option-selector>
                            <label
                              :class="{ '{% if is_color %}border-scheme-text{% else %}bg-scheme-text text-scheme-text-overlay{% endif %}': optionHandles[{{ option_array_index }}] === '{{ value | handleize }}' }"
                              class="relative block text-center border-scheme-text {% unless is_color %} p-2 min-w-variant-option{% else %}p-0.5{% endunless %}  border-1 min-w-4 border cursor-pointer {% unless variant_label_state %}line-through{% endunless %} cursor-pointer" for="Option{{ option.position }}-{{ value | escape }}"
                              title="{{ option.value }}"
                              >
                              {%- if is_color %}
                              {%- unless variant_label_state -%}
                                <span class="absolute top-0 left-0 bottom-0 z-10 h-0.5 w-full bg-scheme-text transform top-1/2 -translate-y-1/2 -rotate-45"></span>
                              {%- endunless -%}
                              <span class="block w-10 h-10" style="background-image: url({{ color_image }}); background-color: {{ color_swatch_fallback }};"></span>
                              {%- endif -%}
                              <span {% if is_color %}class="visually-hidden"{% endif %}>{{ value }}</span>
                            </label>
                          </div>
                        {% endfor %}
                      </div>
                    {%- endunless -%}
                  </fieldset>
                {% endfor %}
              {% endunless %}
            {%- when 'quantity_selector' -%}
              <div {{ block.shopify_attributes }} class="my-8">
                <label class="{{ label_class }}" for="Quantity-{{ section.id }}">{{ 'products.product.quantity' | t }}:</label>
                <template x-if="!enableQuantityInput">
                  <select
                    form="{{ product_form_id }}"
                    id="Quantity-{{ section.id }}"
                    name="quantity"
                    x-model="quantity"
                    class="js-enabled w-16 font-body text-base text-scheme-text"
                    @change="quantityChange()"
                    >
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                    <option value="6">6</option>
                    <option value="7">7</option>
                    <option value="8">8</option>
                    <option value="9">9</option>
                    <option value="10+">10+</option>
                  </select>
                </template>
                <template x-if="enableQuantityInput">
                  <input form="{{ product_form_id }}" x-show="enableQuantityInput" class="block appearance-none border-0 border-b-text-width border-scheme-border p-2 w-16" type="number" id="Quantity-{{ section.id }}" name="quantity" x-model="quantity" min="1" value="1" x-ref="quantityInput">
                </template>
              </div>
            {%- when 'buy_buttons' -%}
              {%- liquid
                assign gift_card_recipient_feature_active = false

                if block.settings.show_gift_card_recipient and product.gift_card?
                  assign gift_card_recipient_feature_active = true
                endif
              -%}
              {% form 'product', product, id: product_form_id, data-product-form: '', data-product-handle: product.handle, data-enable-history-state: 'true', data-product-form: '', x-ref: 'productForm', class: 'my-8' %}
                {{ form | payment_terms }}

                <div class="{% if product.has_only_default_variant %}hidden{% else %}no-js{% endif %}">
                  <label class="{{ label_class }}" for="fallback-selector-{{ section.id }}">Variant</label>
                  <select x-ref="singleVariantSelector" name="id" id="fallback-selector-{{ section.id }}" class="font-secondary text-sm">
                    {% for variant in product.variants %}
                      <option
                        {% if variant == current_variant %}selected="selected"{% endif %}
                        {% unless variant.available %}disabled="disabled"{% endunless %}
                        x-bind:selected="currentVariantId === {{ variant.id }}"
                        value="{{ variant.id }}">
                        {{ variant.title }}
                      </option>
                    {% endfor %}
                  </select>
                </div>

                {%- if gift_card_recipient_feature_active -%}
                  <div class="mb-8">
                    {% render 'gift-card-recipient-form',
                      product: product,
                      form: form,
                      section: section
                    %}
                  </div>
                {%- endif -%}

                {%- liquid
                  assign enable_payment_buttons = block.settings.enable_payment_button
                  assign button_text = 'products.product.add_to_cart' | t
                  if template == 'product.preorder'
                    assign enable_payment_buttons = false
                    assign button_text = 'products.product.preorder' | t
                  endif
                -%}

                {% if enable_payment_buttons or product_modal and gift_card_recipient_feature_active == false %}
                  {% capture add_to_cart_class %}btn-outline-{{ section_color }}-{{ settings.outline_button_color }}{% endcapture %}
                {% else %}
                  {% capture add_to_cart_class %}btn-solid-{{ section_color }}-{{ settings.solid_button_color }}{% endcapture %}
                {% endif %}

                <div class="lg:flex">
                  <div class="{% if enable_payment_buttons and gift_card_recipient_feature_active == false %}lg:w-1/2{% else %}w-full{% endif %}">

                    <button
                      class="add-to-cart-btn w-full btn {{ add_to_cart_class }}
                      {% unless current_variant.available %}opacity-50 cursor-not-allowed{% endunless %}"
                      type="submit"
                      :class="{ 'opacity-50 cursor-not-allowed': !currentVariantAvailable }"
                      :disabled="!currentVariantAvailable"
                      {% unless current_variant.available %}disabled="disabled"{% endunless %}>
                      <span class="no-js">
                        {% if current_variant.available %}
                          {{ button_text }}
                        {% else %}
                          {{ 'products.product.sold_out' | t }}
                        {% endif %}
                      </span>
                      <template x-if="current_variant">
                        <div>
                          <template x-if="loading">
                            <span>{{ 'general.search.loading' | t }}...</span>
                          </template>
                          <template x-if="!loading && currentVariantAvailable">
                            <span>{{ button_text }}</span>
                          </template>
                          <template x-if="!loading && !currentVariantAvailable">
                            <span>{{ 'products.product.sold_out' | t }}</span>
                          </template>
                        </div>
                      </template>
                      <template x-if="!current_variant">
                        <span> {{ 'products.product.unavailable' | t }}</span>
                      </template>
                    </button>
                  </div>

                  {% if enable_payment_buttons and gift_card_recipient_feature_active == false and product.available == true %}
                    <div class="dynamic-payment-buttons payment-buttons-{{ section_color }}-{{ settings.solid_button_color }} mt-4 lg:w-1/2 lg:mt-0 lg:ml-4">
                      {{ form | payment_button }}
                    </div>
                  {% endif %}
                </div>

                {%- if settings.ajax_cart_method == 'page' or settings.show_cart_on_add == false -%}
                <div  class="mt-4 mb-8 rte"
                      tabindex="-1"
                      x-ref="added"
                      x-show="addedToCart"
                      x-cloak
                      x-transition:enter="transition ease duration-300"
                      x-transition:enter-start="opacity-0"
                      x-transition:enter-end="opacity-100"
                      x-transition:leave="transition ease duration-300"
                      x-transition:leave-start="opacity-100"
                      x-transition:leave-end="opacity-0">
                  {{ 'products.product.added_to_cart' | t }}!
                  {{ 'products.product.add_to_cart_confirm_html' | t: cart_url: routes.cart_url, link_url: routes.all_products_collection_url }}.
                </div>
                {%- endif -%}

                <div
                  class="mt-4 mb-8"
                  x-show="addErrorMessage !== ''"
                  style="display: none;"
                  x-transition:enter="transition ease duration-300"
                  x-transition:enter-start="opacity-0"
                  x-transition:enter-end="opacity-100"
                  x-transition:leave="transition ease duration-300"
                  x-transition:leave-start="opacity-100"
                  x-transition:leave-end="opacity-0"
                >
                  <p class="text-scheme-accent" x-text="addErrorMessage"></p>
                </div>
              {% endform %}
              {% if block.settings.show_pickup_availability %}
                <template x-if="$store.availability.current_variant && $store.availability.current_variant.available && currentVariantAvailability">
                  <div class="my-8 flex items-start" :class="{'opacity-50': $store.availability.loading}" :aria-busy="$store.availability.loading">
                    <div class="w-3 mr-3 pt-1">
                      <template x-if="currentVariantAvailability.available">
                        {% render 'icon-in-stock' %}
                      </template>
                      <template x-if="!currentVariantAvailability.available">
                        {% render 'icon-out-of-stock' %}
                      </template>
                    </div>
                    <div class="flex-auto">
                      <h2 x-html="currentVariantAvailability.pickup_text"></h2>
                      <small class="block mt-2" x-html="currentVariantAvailability.pickup_time"></small>
                      <button type="button" @click="$store.drawer.availabilityOpener = $event.currentTarget; $store.drawer.availabilityDrawerOpen = !$store.drawer.availabilityDrawerOpen" aria-haspopup="dialog" class="mt-2 text-scheme-accent hover:text-scheme-text border-b-theme-width border-scheme-border text-sm items-center justify-center pb-0.5">
                        <span class="" x-text="currentVariantAvailability.modal_text"></span>
                      </button>
                    </div>
                  </div>
                </template>
                <div class=""
                    data-product-title="{{ product.title | escape }}"
                    data-has-only-default-variant="{{ product.has_only_default_variant }}"
                    data-base-url="{{ shop.url }}{{ routes.root_url }}"
                    data-store-availability>
                </div>
              {% endif %}
            {%- when 'description' -%}
              {%- liquid
                assign enable_collapsible_tabs = block.settings.enable_collapsible_tabs
                assign truncate_description = block.settings.truncate_description
                render 'product-block-description', product: product, enable_collapsible_tabs: enable_collapsible_tabs, truncate_description: truncate_description
              -%}
            {%- when 'text' -%}
              {% render 'product-block-text', block: block %}
            {%- when 'richtext' -%}
              {% render 'product-block-richtext', block: block %}
            {%- when 'ordered_list' -%}
              {% render 'product-block-ordered-list', block: block %}
            {%- when 'audio_player' -%}
              {% render 'product-block-audio-player', block: block, featured_media: featured_media, product_title: product.title, product_handle: product.handle, section_color: section_color %}
            {%- when 'audio_player_tracklist' -%}
              {% render 'product-block-audio-player-tracklist', block: block, section_color: section_color %}
            {%- when 'collapsible_tab' -%}
              {% render 'product-block-collapsible-tab',
                block: block,
                section_color: section_color
              %}
            {%- when 'icon_list' -%}
              {% render 'product-block-icon-list', block: block, section_color: section_color %}
            {%- when 'popup' -%}
              {% render 'product-block-popup', block: block, section_color: section_color %}
            {%- when 'star_rating' -%}
              {% if block.settings.type == 'spr' %}
                {{ 'spr-ratings.css' | asset_url | stylesheet_tag }}
              {% elsif block.settings.type == 'native' %}
                {{ 'ratings.css' | asset_url | stylesheet_tag }}
              {% endif %}
              <div class="my-6" style="--product-grid-star-color: var(--color-{{ section_color }}-{{ block.settings.star_color }}); --product-grid-star-background-color: rgba(var(--color-{{ section_color }}-text-rgb), 0.1); --product-grid-caption-color: var(--color-{{ section_color }}-text);" {{ block.shopify_attributes }}>
                {% render 'star-rating',
                   type: block.settings.type,
                   product: product
                %}
              </div>
            {%- when 'share_buttons' -%}
              <div class="" {{ block.shopify_attributes }}>
                {% render 'social-sharing', share_title: product.title, share_permalink: product.url, share_image: product.featured_media %}
              </div>
            {%- when 'location_inventory_status' -%}
              <div class=""
                  data-product-title="{{ product.title | escape }}"
                  data-has-only-default-variant="{{ product.has_only_default_variant }}"
                  data-base-url="{{ shop.url }}{{ routes.root_url }}"
                  data-locations-to-show="{{ block.settings.locations_to_show }}"
                  x-ref="locationInventoryData"
                  data-store-availability>
              </div>
              {% render 'product-block-location-status', block: block, current_variant: current_variant, section_color: section_color %}
            {%- when 'specification_list' -%}
              {% render 'product-block-specification-list', block: block, section_color: section_color, section_color: section_color %}
            {%- when 'quote' -%}
              {% render 'product-block-quote', block: block, section_color: section_color %}
            {%- when 'inventory_status' -%}
              {% render 'product-block-inventory-status', block: block, product: product, section_color: section_color %}
            {%- when 'html' -%}
              <div class="my-8" {{ block.shopify_attributes }}>
                {{ block.settings.custom_html }}
              </div>
            {%- when 'complementary' -%}
              {%- render 'product-block-complementary', block: block, section_color: section_color, product: product -%}
          {%- endcase -%}
        {%- endfor -%}

        {%- if has_buy_it_with == true and layout contains 'full_width' -%}
          <div class="-mt-theme-width border-t-theme-width border-b-theme-width border-scheme-border py-8">
            <h2 class="font-{{ buy_it_with_block.settings.heading_text_style }} mb-6">{{ buy_it_with_block.settings.heading }}</h2>
            <div class="grid gap-4 grid-cols-2 lg:grid-cols-3">
              {%- for buy_it_with_product in buy_it_with_block.settings.product_list -%}
                <div class="lg:mb-10">
                  {%- render 'product-grid-item', product: buy_it_with_product, section_color: section_color -%}
                </div>
              {%- endfor -%}
            </div>
          </div>
        {%- endif -%}
      </div>

    </div>

    {% if has_buy_it_with == true and layout contains 'narrow_width' %}
      <div class="col-span-1 lg:col-span-2">
        <h2 class="font-{{ buy_it_with_block.settings.heading_text_style }} mb-6">{{ buy_it_with_block.settings.heading }}</h2>
        <div class="grid gap-4 grid-cols-2 lg:grid-cols-1">
          {%- for buy_it_with_product in buy_it_with_block.settings.product_list -%}
            <div class="lg:mb-10">
              {%- render 'product-grid-item', product: buy_it_with_product, section_color: section_color -%}
            </div>
          {%- endfor -%}
        </div>
      </div>
    {% endif %}
  </div>



  {% unless product == empty %}
    <script type="application/json" data-product-json>
      {{ all_products[product.handle] | json }}
    </script>
    <script type="application/json" data-selected-variant-json>
      {{ current_variant | json }}
    </script>
    <script type="application/json" data-featured-media-id>
      {{ featured_media.id | json }}
    </script>

    {% if section.settings.enable_image_zoom %}
    <script type="application/json" data-product-images>
    [
      {% for image in product.images %}
        {
          "fullSizeUrl": {{ image | img_url: 'master' | json }},
          "width": {{ image.width | json }},
          "height": {{ image.height | json }},
          "aspectRatio": {{ image.aspect_ratio | json }}
        }{% unless forloop.last %},{% endunless %}
      {% endfor %}
    ]
    </script>
    {% endif %}
    <script type="application/json" id="ModelJson-{{ section.id }}">
      {{ product.media | where: 'media_type', 'model' | json }}
    </script>
  {% endunless %}

  {%- for block in popup_blocks -%}
  <div x-show="$store['ThemePopUp_{{ block.id }}'].open">
    <div  x-ref="modal" id="ThemePopUp_{{ block.id }}" class="product-popup-modal fixed top-0 left-0 right-0 bottom-0 flex justify-center items-center p-4 lg:p-24 z-100" x-cloak>
      <div class="p-4 lg:p-8 border-grid border-grid-color bg-scheme-background text-scheme-text w-full max-w-2xl relative max-h-full overflow-auto z-10"
          role="dialog" aria-label="{{ block.settings.link_label }}" aria-modal="true" tabindex="-1">
        <button id="ThemePopUp_{{ block.id }}_CloseBtn" x-ref="close" @click="$store['ThemePopUp_{{ block.id }}'].open = false" type="button"  class="block p-1 w-8 ml-auto absolute top-2 right-2" autofocus>
          <span class="visually-hidden">{{ 'general.accessibility.close_modal' | t }}</span>
          <span class="inline-block w-6 h-6">{% render 'icon-close' %}</span>
        </button>
        <div class="product-popup-modal__content-info">
          <h2 class="font-heading text-2xl">{{ block.settings.page.title }}</h2>
          <div class="rte mt-8">{{ block.settings.page.content }}</div>
        </div>
      </div>
      <div @click="$store['ThemePopUp_{{ block.id }}'].open = false" role="button" class="absolute top-0 right-0 bottom-0 left-0 z-0 w-full h-full bg-scheme-text opacity-90"></div>
    </div>
  </div>
  {%- endfor -%}
</section>
{% comment %}theme-check-enable MissingTemplate,TemplateLength{% endcomment %}
